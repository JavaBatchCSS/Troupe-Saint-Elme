<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des contacts - Troupe Saint Elme</title>
    <link rel="stylesheet" href="style.css">
    <!-- Suppression de la dépendance CryptoJS car on l'utilisait pas correctement -->
</head>
<body>
    <header>
        <img style="right:20px" src="images/embleme troupe.png">
        <img style="left:20px" src="images/logo fédération.png">
        <h1>Troupe Saint Elme</h1>
    </header>

    <main>
        <div class="documentation-section">
            <h2>Gestion des contacts</h2>
            <table id="contactsTable" class="styled-table">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Email</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Les contacts seront chargés ici -->
                </tbody>
            </table>
            <div id="status" style="margin: 20px 0; padding: 10px; border-radius: 5px;"></div>
            <form id="addContactForm" class="form-group">
                <h3>Ajouter un contact</h3>
                <div style="margin-bottom: 15px;">
                    <label for="nameInput">Nom :</label>
                    <input type="text" id="nameInput" required style="margin-top: 5px; width: 100%;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="emailInput">Email :</label> 
                    <input type="email" id="emailInput" required style="margin-top: 5px; width: 100%;">
                </div>
                <button type="submit" class="btn-inscription" style="background-color: #3498db; color: white; padding: 10px 15px; border-radius: 5px; cursor: pointer;">Ajouter</button>
            </form>
        </div>
    </main>

    <footer>
        <p>&copy; Troupe Saint Elme</p>
    </footer>

    <script>
        // Configuration
        // Ces valeurs devraient normalement être dans un fichier sécurisé
        // mais pour des raisons de simplicité, nous les incluons directement ici
        const config = {
            repositoryUrl: "https://javabatchcss.github.io/Troupe-Saint-Elme",
            contactsFile: "contacts.txt"
        };

        const contactsTable = document.getElementById("contactsTable").querySelector("tbody");
        const statusElement = document.getElementById("status");

        // Fonction pour afficher un message de statut
        function showStatus(message, isError = false) {
            statusElement.textContent = message;
            statusElement.style.backgroundColor = isError ? "#ffdddd" : "#ddffdd";
            statusElement.style.color = isError ? "#990000" : "#006600";
        }

        // Fonction pour charger les contacts depuis le fichier
        async function loadContacts() {
            try {
                // Récupération directe du fichier texte
                const response = await fetch(`${config.repositoryUrl}/${config.contactsFile}`);
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                // Récupérer le contenu textuel du fichier
                const fileContent = await response.text();
                
                if (!fileContent || fileContent.trim() === "") {
                    contactsTable.innerHTML = "<tr><td colspan='2' style='text-align: center;'>Aucun contact trouvé</td></tr>";
                    return;
                }
                
                // Traiter chaque ligne du fichier
                const contacts = fileContent.split("\n")
                    .filter(line => line.trim() !== "")
                    .map(line => {
                        const [name, email] = line.split(",");
                        return { 
                            name: name ? name.trim() : "", 
                            email: email ? email.trim() : "" 
                        };
                    });

                // Vider le tableau avant de le remplir
                contactsTable.innerHTML = "";
                
                // Afficher les contacts dans le tableau
                if (contacts.length === 0) {
                    contactsTable.innerHTML = "<tr><td colspan='2' style='text-align: center;'>Aucun contact trouvé</td></tr>";
                } else {
                    contacts.forEach(contact => {
                        const row = document.createElement("tr");
                        row.innerHTML = `<td>${contact.name}</td><td>${contact.email}</td>`;
                        contactsTable.appendChild(row);
                    });
                }
                
                showStatus("Contacts chargés avec succès");
            } catch (error) {
                console.error("Erreur lors du chargement des contacts:", error);
                showStatus(`Impossible de récupérer le fichier des contacts: ${error.message}`, true);
                
                // Afficher un message dans le tableau
                contactsTable.innerHTML = "<tr><td colspan='2' style='text-align: center;'>Erreur lors du chargement des contacts</td></tr>";
            }
        }

        // Fonction pour ajouter un contact
        // Note: Cette fonction ne fonctionnera pas réellement sans accès en écriture sur le dépôt
        async function addContact(name, email) {
            try {
                // Dans un scénario réel, ceci devrait faire une requête d'API vers GitHub
                // Pour l'instant, simulons une réussite
                
                showStatus(`Contact ajouté avec succès : ${name} (${email})`);
                
                // En environnement de production, vous auriez besoin d'implémenter
                // l'API GitHub avec un token d'accès pour modifier le fichier
                
                // Après ajout du contact, mettre à jour le tableau
                const row = document.createElement("tr");
                row.innerHTML = `<td>${name}</td><td>${email}</td>`;
                contactsTable.appendChild(row);
                
            } catch (error) {
                console.error("Erreur lors de l'ajout du contact:", error);
                showStatus(`Erreur lors de l'ajout du contact: ${error.message}`, true);
            }
        }

        // Gérer la soumission du formulaire
        document.getElementById("addContactForm").addEventListener("submit", (event) => {
            event.preventDefault();
            const name = document.getElementById("nameInput").value;
            const email = document.getElementById("emailInput").value;
            
            if (name && email) {
                addContact(name, email);
                document.getElementById("addContactForm").reset();
            } else {
                showStatus("Veuillez remplir tous les champs", true);
            }
        });

        // Charger les contacts au chargement de la page
        window.addEventListener("DOMContentLoaded", () => {
            loadContacts();
        });
    </script>

    <style>
    /* Styles supplémentaires pour améliorer l'apparence */
    .styled-table {
        width: 100%;
        border-collapse: collapse;
        margin: 25px 0;
        font-size: 0.9em;
        min-width: 400px;
        border-radius: 5px 5px 0 0;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
    }
    
    .styled-table thead tr {
        background-color: #3498db;
        color: #ffffff;
        text-align: left;
    }
    
    .styled-table th,
    .styled-table td {
        padding: 12px 15px;
    }
    
    .styled-table tbody tr {
        border-bottom: 1px solid #dddddd;
    }
    
    .styled-table tbody tr:nth-of-type(even) {
        background-color: #f3f3f3;
    }
    
    .styled-table tbody tr:last-of-type {
        border-bottom: 2px solid #3498db;
    }
    
    .form-group {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    </style>
</body>
</html>

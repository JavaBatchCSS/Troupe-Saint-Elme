<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Personnalisable</title>
    <style>
        /* Style de base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #F5F5F5;
        }

        /* En-tête (NON MODIFIABLE PAR L'ÉDITEUR) */
        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px;
            background-color: #3498db;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .logo-titre {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 100%;
            margin-bottom: 15px;
        }

        header img {
            height: 75px;
            width: auto;
            position: absolute;
            margin: 0 10px;
        }

        header h1 {
            margin: 0;
            color: RGB(245, 245, 245);
            font-size: 2rem;
        }

        /* Navigation (NON MODIFIABLE PAR L'ÉDITEUR) */
        nav {
            width: 100%;
            margin-top: 15px;
        }

        nav ul {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            list-style: none;
            padding: 0;
        }

        nav li {
            margin: 5px;
        }

        nav a:hover, nav a.active {
            background-color: RGB(255, 255, 255);
            color: #3498db;
        }
        nav a {
            display: block;
            padding: 8px 15px;
            text-decoration: none;
            color: RGB(0, 69, 120);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        /* Contenu principal (MODIFIABLE PAR L'ÉDITEUR) */
        main {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .editable-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            padding: 25px;
            overflow: hidden;
        }

        .editable-section h2 {
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .editable-paragraph {
            margin-bottom: 20px;
        }

        .editable-image {
            display: block;
            max-width: 100%;
            height: auto;
            margin: 0 auto;
            border-radius: 5px;
        }

        /* Pied de page (NON MODIFIABLE PAR L'ÉDITEUR) */
        footer {
            text-align: center;
            padding: 10px;
            background-color: #333;
            color: white;
        }

        
        /* Styles spécifiques fournis */
        /* Style de base */
        /* (Répétition de styles de base, je vais considérer que les précédents suffisent) */

        /* En-tête */
        /* (Styles d'en-tête déjà inclus) */

        /*Navigation*/
        /* (Styles de navigation déjà inclus) */

        /* Contenu principal */
        /* (Styles de contenu principal adaptés pour l'édition) */

        /*Images*/
        .Proportions-de-l’image-A4 {
            display: block;
            max-width: 100%;
            height: auto;
            margin: 0 auto;
            border-radius: 5px;
        }

        /* Boutons de contenu */
        .boutons-contenu {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
        }

        .bouton {
            flex: 1 1 250px;
            max-width: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
        }

        .mobile-nav-active {
            display: block;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .logo-title {
            padding-right: 40px; /* Espace pour le bouton menu */
        }

        /* Pour la page À propos */
        .about-grid, .team-grid {
            grid-template-columns: 1fr;
        }

        .timeline-item, .timeline-item:nth-child(even) {
            padding-right: 0;
            padding-left: 40px;
            justify-content: flex-start;
        }

        .timeline-line {
            left: 20px;
        }

        .timeline-date {
            left: 20px;
            width: 70px;
            font-size: 0.9em;
        }

        .about-container {
            margin: 20px;
            padding: 15px;
        }

        .value-item {
            width: 100%;
        }

        .contact-buttons {
            flex-direction: column;
        }

        /* Pour petits écrans */
        @media (max-width: 480px) {
            header img {
                height: 45px;
            }

            .about-container h1 {
                font-size: 1.8em;
            }

            .À-PROPOS-SECTION h2 {
                font-size: 1.4em;
            }

            .membre-de-l’équipe img {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <header>
        <img style="right:20px" src="images/embleme troupe.png" alt="Emblème troupe">
        <img style="left:20px" src="images/logo fédération.png" alt="Logo fédération">
        <h1>Troupe Saint Elme</h1>
        <nav>
            <ul>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/index.html" class="active">Accueil</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2023.html">2023</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2024.html">2024</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2025.html">2025</a></li>
                <li><a href="histoire.html">Historique</a></li>
                <li style="width: 20px;"></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/about-us.html">À Propos</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/contact-us.html">Contact</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/documentation.html">Documentation</a></li>
                <li><a href="https://www.fsggb.fr/">Site de la Fédération</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="editable-section" data-section="installations">
            <h2 data-field="title">Nos Installations</h2>
            <p class="editable-paragraph" data-field="description">Découvrez nos campements et installations uniques, conçus pour allier tradition et modernité.</p>
            <img data-field="image" src="images/installations.jpg" alt="Installations de la troupe" class="editable-image Proportions-de-l’image-A4">
        </section>

        <section class="editable-section" data-section="concours_cuisine">
            <h2 data-field="title">Concours Cuisine</h2>
            <p class="editable-paragraph" data-field="description">Participez à notre célèbre concours de cuisine, un événement incontournable de la vie de la troupe. </p>
            <img data-field="image" src="images/concours_cuisine.jpg" alt="Concours de cuisine" class="editable-image Proportions-de-l’image-A4">
        </section>

        <section class="editable-section" data-section="evenements_marquants">
            <h2 data-field="title">Événements Marquants</h2>
            <p class="editable-paragraph" data-field="description">Revivez les moments forts des dernières années, de nos aventures en forêt à nos soirées mémorables. </p>
            <div class="boutons-contenu">
                <a href="annee_2025.html" class="bouton">
                    <img src="images/annee_2025_mini.jpg" alt="Activités 2025">
                    <span>Activités 2025</span>
                </a>
                <a href="annee_2024.html" class="bouton">
                    <img src="c_e_r_f.jpg" alt="Souvenirs 2024">
                    <span>Souvenirs 2024</span>
                </a>
                <a href="annee_2023.html" class="bouton">
                    <img src="images/annee_2023_mini.jpg" alt="Événements 2023">
                    <span>Événements 2023</span>
                </a>
            </div>
        </section>

        <section class="editable-section" data-section="galerie_photos">
            <h2 data-field="title">Galerie Photos</h2>
            <div class="photo-vitrine">
                <div class="vitrine-main">
                    <img id="showcase-current" data-field="main_image" src="images/photo1.jpg" alt="Image principale">
                    <div class="showcase-nav">
                        <button id="prev-btn" class="nav-btn" aria-label="Image précédente">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 18l-6-6 6-6"></path>
                            </svg>
                        </button>
                        <button id="next-btn" class="nav-btn" aria-label="Image suivante">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 18l6-6-6-6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="showcase-thumbnails" id="conteneur-de-vignettes">
                    </div>
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; Troupe Saint Elme</p>
    </footer>

    <script type="module">
        // Importez les fonctions nécessaires de Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getDatabase, ref, onValue, update } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js';

        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAM6sKRp9OM0u3A5IYAPVPzVby_c78v3-U",
  authDomain: "troupe-saint-elme.firebaseapp.com",
  databaseURL: "https://troupe-saint-elme-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "troupe-saint-elme",
  storageBucket: "troupe-saint-elme.firebasestorage.app",
  messagingSenderId: "1005499161402",
  appId: "1:1005499161402:web:45af5ebb1e68a931178e03",
  measurementId: "G-80KTBHE928"
};

        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const pageDataRef = ref(database, 'pageContent');

        // Charger le contenu depuis Firebase au chargement de la page
        onValue(pageDataRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                Object.keys(data).forEach(sectionId => {
                    const sectionData = data[sectionId];
                    const sectionElement = document.querySelector(`[data-section="${sectionId}"]`);
                    if (sectionElement) {
                        Object.keys(sectionData).forEach(field => {
                            const element = sectionElement.querySelector(`[data-field="${field}"]`);
                            if (element) {
                                if (element.tagName === 'IMG') {
                                    element.src = sectionData[field];
                                } else if (element.tagName === 'H2' || element.tagName === 'P' || element.tagName === 'SPAN') {
                                    element.textContent = sectionData[field];
                                }
                            }
                        });
                    }
                });
            }
            initializeGallery(); // Initialiser la galerie après le chargement initial
        });

        // Fonction pour rendre les sections éditables
        function makeEditable(element, sectionId, field) {
            element.contentEditable = true;
            element.style.border = '1px dashed #ccc';
            element.addEventListener('blur', (event) => {
                element.contentEditable = false;
                element.style.border = '';
                const updatedValue = event.target.textContent;
                updateFirebase(sectionId, field, updatedValue);
            });
            element.addEventListener('input', (event) => {
                // Empêcher le comportement par défaut de la tabulation dans les éléments éditables
                if (event.key === 'Tab') {
                    event.preventDefault();
                    const selection = window.getSelection();
                    const range = selection.getRangeAt(0);
                    const tabNode = document.createTextNode('\t');
                    range.insertNode(tabNode);
                    range.collapse(false);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            });
        }

        // Fonction pour rendre les images éditables (changement de source)
        function makeImageEditable(imgElement, sectionId, field) {
            imgElement.addEventListener('click', () => {
                const newImageUrl = prompt('Entrez la nouvelle URL de l\'image :');
                if (newImageUrl) {
                    imgElement.src = newImageUrl;
                    updateFirebase(sectionId, field, newImageUrl);
                }
            });
            imgElement.style.cursor = 'pointer';
        }

        // Fonction pour mettre à jour Firebase
        function updateFirebase(sectionId, field, value) {
            const sectionRef = ref(database, `pageContent/<span class="math-inline">\{sectionId\}/</span>{field}`);
            update(sectionRef, value)
                .then(() => console.log(`Champ "<span class="math-inline">\{field\}" de la section "</span>{sectionId}" mis à jour avec : ${value}`))
                .catch((error) => console.error("Erreur lors de la mise à jour de Firebase : ", error));
        }

        // Sélectionner les éléments éditables
        document.querySelectorAll('.editable-section').forEach(section => {
            const sectionId = section.dataset.section;
            section.querySelectorAll('[data-field]').forEach(element => {
                const field = element.dataset.field;
                if (element.tagName === 'IMG') {
                    makeImageEditable(element, sectionId, field);
                } else {
                    makeEditable(element, sectionId, field);
                }
            });
        });

        // --- Gestion de la galerie photo ---
        const photoVitrines = document.querySelectorAll('.photo-vitrine');

        photoVitrines.forEach(vitrine => {
            const showcaseCurrent = vitrine.querySelector('#showcase-current');
            const prevBtn = vitrine.querySelector('#prev-btn');
            const nextBtn = vitrine.querySelector('#next-btn');
            const thumbnailsContainer = vitrine.querySelector('#conteneur-de-vignettes');
            const sectionElement = vitrine.closest('.editable-section');
            const sectionId = sectionElement ? sectionElement.dataset.section : null;

            let images = [];
            let currentIndex = 0;

            // Fonction pour charger et afficher les miniatures
            function loadThumbnails() {
                thumbnailsContainer.innerHTML = '';
                images.forEach((imageUrl, index) => {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = `Miniature ${index + 1}`;
                    img.classList.add('thumbnail');
                    img.addEventListener('click', () => {
                        currentIndex = index;
                        updateShowcase();
                    });
                    thumbnailsContainer.appendChild(img);
                });
            }

            // Fonction pour mettre à jour l'image principale
            function updateShowcase() {
                if (images.length > 0) {
                    showcaseCurrent.src = images[currentIndex];
                    updateFirebase(sectionId, 'main_image', images[currentIndex]); // Mettre à jour l'image principale dans Firebase
                }
            }

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    if (images.length > 0) {
                        currentIndex = (currentIndex - 1 + images.length) % images.length;
                        updateShowcase();
                    }
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    if (images.length > 0) {
                        currentIndex = (currentIndex + 1) % images.length;
                        updateShowcase();
                    }
                });
            }

            // Écouter les changements dans Firebase pour la galerie
            if (sectionId) {
                const galleryRef = ref(database, `pageContent/${sectionId}/gallery`);
                onValue(galleryRef, (snapshot) => {
                    const galleryData = snapshot.val();
                    if (galleryData && Array.isArray(galleryData)) {
                        images = galleryData;
                        loadThumbnails();
                        updateShowcase();
                    } else {
                        images = [];
                        thumbnailsContainer.innerHTML = '';
                        showcaseCurrent.src = '';
                    }
                });

                // Permettre l'ajout de nouvelles images à la galerie
                const addImageButton = document.createElement('button');
                addImageButton.textContent = 'Ajouter une image à la galerie';
                addImageButton.classList.add('bouton');
                addImageButton.style.marginTop = '10px';
                sectionElement.appendChild(addImageButton);

                addImageButton.addEventListener('click', () => {
                    const newImageUrl = prompt('Entrez l\'URL de la nouvelle image pour la galerie :');
                    if (newImageUrl) {
                        const updatedGallery = [...images, newImageUrl];
                        update(galleryRef, updatedGallery)
                            .then(() => console.log('Image ajoutée à la galerie.'))
                            .catch((error) => console.error('Erreur lors de l\'ajout de l\'image à la galerie :', error));
                    }
                });

                // Style pour les miniatures
                const style = document.createElement('style');
                style.textContent = `
                    .thumbnail {
                        width: 50px;
                        height: 50px;
                        margin: 5px;
                        cursor: pointer;
                        object-fit: cover;
                        border-radius: 3px;
                        border: 1px solid #ddd;
                    }
                    .showcase-thumbnails {
                        display: flex;
                        overflow-x: auto;
                        margin-top: 10px;
                    }
                    .photo-vitrine {
                        margin-top: 20px;
                    }
                    .vitrine-main {
                        position: relative;
                    }
                    .showcase-nav button {
                        position: absolute;
                        top: 50%;
                        transform: translateY(-50%);
                        background: rgba(0, 0, 0, 0.5);
                        color: white;
                        border: none;
                        padding: 10px;
                        cursor: pointer;
                        z-index: 10;
                    }
                    #prev-btn {
                        left: 10px;
                    }
                    #next-btn {
                        right: 10px;
                    }
                `;
                document.head.appendChild(style);
            }
        });

        // Fonction d'initialisation de la galerie (appelée après le chargement initial des données)
        function initializeGallery() {
            const photoVitrinesInit = document.querySelectorAll('.photo-vitrine');
            photoVitrinesInit.forEach(vitrine => {
                // Le code d'initialisation de chaque galerie est déjà inclus dans la boucle principale
                // après la récupération des données Firebase.
            });
        }
    </script>
</body>
</html>

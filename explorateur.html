<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur de fichiers - Troupe Saint Elme</title>
    <link rel="icon" href="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --bg-main: #f5f5f5;
            --bg-header: #f0f0f0;
            --border-color: #dadada;
            --hover-color: #e5f3ff;
            --select-color: #cce8ff;
            --accent-color: #3498db;
            --text-color: #333;
            --text-light: #888;
            --menu-bg: white;
            --menu-hover: #f0f0f0;
            --icon-size: 20px;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header & Ribbon */
        .header {
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            display: flex;
            align-items: center;
            height: 40px;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }

        .logo img {
            height: 28px;
            margin-right: 8px;
        }

        .logo h1 {
            font-size: 16px;
            font-weight: normal;
        }

        .ribbon {
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 4px 10px;
            height: 56px;
            display: flex;
            flex-direction: column;
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 5px;
        }

        .tab {
            padding: 3px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 13px;
        }

        .tab:hover {
            background-color: var(--hover-color);
        }

        .tab.active {
            background-color: var(--select-color);
        }

        .toolbar {
            display: flex;
            gap: 10px;
        }

        .toolbar-group {
            display: flex;
            border-right: 1px solid var(--border-color);
            padding-right: 10px;
            margin-right: 10px;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 11px;
            padding: 2px 5px;
            border-radius: 3px;
            cursor: pointer;
        }

        .toolbar-button:hover {
            background-color: var(--hover-color);
        }

        .toolbar-button svg {
            height: var(--icon-size);
            width: var(--icon-size);
            margin-bottom: 2px;
        }

        /* Main container */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-main);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 10px 0;
        }

        .sidebar-section {
            margin-bottom: 10px;
        }

        .sidebar-header {
            padding: 5px 10px;
            font-weight: bold;
            font-size: 13px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 13px;
        }

        .sidebar-item:hover {
            background-color: var(--hover-color);
        }

        .sidebar-item.active {
            background-color: var(--select-color);
        }

        .sidebar-item svg {
            margin-right: 8px;
            height: 16px;
            width: 16px;
        }

        /* Navigation bar */
        .navbar {
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            display: flex;
            align-items: center;
            height: 40px;
            flex-wrap: nowrap;
            gap: 5px;
        }

        .nav-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 3px;
            cursor: pointer;
        }

        .nav-button:hover {
            background-color: var(--hover-color);
        }

        .nav-button svg {
            height: 16px;
            width: 16px;
        }

        .nav-button.disabled {
            opacity: 0.5;
            cursor: default;
        }

        .nav-button.disabled:hover {
            background-color: transparent;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 0 5px;
            height: 30px;
            flex: 1;
            overflow: hidden;
            background-color: white;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0 5px;
            border-radius: 3px;
            white-space: nowrap;
        }

        .breadcrumb-item:hover {
            background-color: var(--hover-color);
        }

        .breadcrumb-separator {
            margin: 0 5px;
            color: var(--text-light);
        }

        .search-box {
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 0 5px;
            height: 30px;
            width: 200px;
            background-color: white;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            padding: 0 5px;
            font-size: 13px;
        }

        .search-box svg {
            height: 16px;
            width: 16px;
            color: var(--text-light);
        }

        /* File explorer main area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .files-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            grid-gap: 10px;
            align-content: start;
        }

        .file-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
            text-align: center;
            height: 100px;
            position: relative;
        }

        .file-item:hover {
            background-color: var(--hover-color);
        }

        .file-item.selected {
            background-color: var(--select-color);
        }

        .file-icon {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .file-name {
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            word-break: break-word;
            max-height: 36px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .file-item input {
            width: 100%;
            border: 1px solid var(--accent-color);
            outline: none;
            padding: 2px;
            font-size: 12px;
            position: absolute;
            bottom: 5px;
            text-align: center;
        }

        /* Status bar */
        .status-bar {
            background-color: var(--bg-header);
            border-top: 1px solid var(--border-color);
            padding: 3px 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            height: 24px;
        }

        .status-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Context menu */
        .context-menu {
            position: absolute;
            background-color: var(--menu-bg);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 5px 0;
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 13px;
        }

        .menu-item:hover {
            background-color: var(--menu-hover);
        }

        .menu-item svg {
            margin-right: 8px;
            height: 16px;
            width: 16px;
        }

        .menu-separator {
            height: 1px;
            background-color: var(--border-color);
            margin: 5px 0;
        }

        /* Dropzone */
        .dropzone {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(52, 152, 219, 0.2);
            border: 3px dashed var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--accent-color);
            z-index: 999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .dropzone.active {
            opacity: 1;
        }

        /* Dialogs */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            display: none;
        }

        .dialog {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 400px;
            padding: 20px;
        }

        .dialog-title {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .dialog-content {
            margin-bottom: 20px;
        }

        .dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dialog-button {
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .dialog-button.primary {
            background-color: var(--accent-color);
            color: white;
        }

        .dialog-button.secondary {
            background-color: var(--bg-header);
            color: var(--text-color);
        }

        /* List view */
        .list-view {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .list-header {
            display: flex;
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            font-weight: bold;
            font-size: 13px;
        }

        .list-column {
            flex: 1;
            padding: 5px;
        }

        .list-column.name {
            flex: 2;
        }

        .list-item {
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            cursor: pointer;
        }

        .list-item:hover {
            background-color: var(--hover-color);
        }

        .list-item.selected {
            background-color: var(--select-color);
        }

        .list-cell {
            flex: 1;
            padding: 5px;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-cell.name {
            flex: 2;
            display: flex;
            align-items: center;
        }

        .list-cell svg, .list-cell .file-type-icon {
            margin-right: 5px;
            height: 16px;
            width: 16px;
            flex-shrink: 0;
        }

        /* Popup notifications */
        .notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 2000;
        }

        .notification {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s, fadeOut 0.5s 4.5s;
            max-width: 300px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .notification svg {
            height: 20px;
            width: 20px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-light);
        }

        .notification.info svg {
            color: var(--accent-color);
        }

        .notification.success svg {
            color: #27ae60;
        }

        .notification.error svg {
            color: #e74c3c;
        }

        .notification.warning svg {
            color: #f39c12;
        }

        .drag-image {
            position: absolute;
            pointer-events: none;
            z-index: 1001;
            opacity: 0.7;
            display: flex;
            align-items: center;
            background-color: var(--select-color);
            padding: 5px 10px;
            border-radius: 3px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 13px;
        }

        .drag-image svg {
            margin-right: 5px;
            height: 16px;
            width: 16px;
        }

        .detail-view {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        /* Tree view in sidebar */
        .tree-view {
            padding-left: 10px;
        }
        
        .tree-item {
            display: flex;
            align-items: center;
            padding: 2px 5px;
            cursor: pointer;
            font-size: 13px;
            position: relative;
        }
        
        .tree-item:hover {
            background-color: var(--hover-color);
        }
        
        .tree-item.active {
            background-color: var(--select-color);
        }
        
        .tree-toggle {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 2px;
            font-size: 10px;
        }

        .tree-icon {
            margin-right: 5px;
        }
        
        .tree-children {
            padding-left: 15px;
            display: none;
        }
        
        .tree-children.expanded {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Header with logo -->
    <div class="header">
        <div class="logo">
            <img src="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png" alt="Logo">
            <h1>Explorateur de fichiers - Troupe Saint Elme</h1>
        </div>
    </div>

    <!-- Ribbon with tabs and toolbar -->
    <div class="ribbon">
        <div class="tabs">
            <div class="tab active">Accueil</div>
            <div class="tab">Partager</div>
            <div class="tab">Affichage</div>
        </div>
        <div class="toolbar">
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-cut" data-action="cut" title="Couper (Ctrl+X)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z" />
                    </svg>
                    Couper
                </div>
                <div class="toolbar-button" id="btn-copy" data-action="copy" title="Copier (Ctrl+C)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
                    </svg>
                    Copier
                </div>
                <div class="toolbar-button" id="btn-paste" data-action="paste" title="Coller (Ctrl+V)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z" />
                    </svg>
                    Coller
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-upload" data-action="upload" title="Importer">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z" />
                    </svg>
                    Importer
                </div>
                <div class="toolbar-button" id="btn-new-folder" data-action="new-folder" title="Nouveau dossier">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M10,4L12,6H20A2,2 0 0,1 22,8V18A2,2 0 0,1 20,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10M15,9V12H12V14H15V17H17V14H20V12H17V9H15Z" />
                    </svg>
                    Nouveau dossier
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-rename" data-action="rename" title="Renommer (F2)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M18.41,5.8L17.2,4.59C16.41,3.8 15.14,3.8 14.34,4.59L4.59,14.34L3,17.75V21H6.25L9.66,19.41L19.41,9.66C20.2,8.86 20.2,7.59 19.41,6.8M6.92,19H5V17.08L6.17,16.67L7.33,17.83L6.92,19M5.95,15.18L7.82,17.05L16.07,8.8L14.2,6.93L5.95,15.18Z" />
                    </svg>
                    Renommer
                </div>
                <div class="toolbar-button" id="btn-delete" data-action="delete" title="Supprimer (Suppr)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                    </svg>
                    Supprimer
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-undo" data-action="undo" title="Annuler (Ctrl+Z)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z" />
                    </svg>
                    Annuler
                </div>
                <div class="toolbar-button" id="btn-redo" data-action="redo" title="Rétablir (Ctrl+Y)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z" />
                    </svg>
                    Rétablir
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-view-toggle" data-action="view-toggle" title="Changer de vue">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9" />
                    </svg>
                    Vue
                </div>
                <div class="toolbar-button" id="btn-refresh" data-action="refresh" title="Actualiser (F5)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
                    </svg>
                    Actualiser
                </div>
            </div>
        </div>
    </div>

    <!-- Main container with sidebar and content -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-header">Accès rapide</div>
                <div class="sidebar-item" data-path="/">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" />
                    </svg>
                    Accueil
                </div>
                <div class="sidebar-item" data-path="/documents">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z" />
                    </svg>
                    Documents
                </div>
                <div class="sidebar-item" data-path="/images">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z" />
                    </svg>
                    Images
                </div>
                <div class="sidebar-item" data-path="/videos">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z" />
                    </svg>
                    Vidéos
                </div>
                <div class="sidebar-item" data-path="/music">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M21,3V15.5A3.5,3.5 0 0,1 17.5,19A3.5,3.5 0 0,1 14,15.5A3.5,3.5 0 0,1 17.5,12C18.04,12 18.55,12.12 19,12.34V6.47L9,8.6V17.5A3.5,3.5 0 0,1 5.5,21A3.5,3.5 0 0,1 2,17.5A3.5,3.5 0 0,1 5.5,14C6.04,14 6.55,14.12 7,14.34V6L21,3Z" />
                    </svg>
                    Musique
                </div>
                <div class="sidebar-item" data-path="/downloads">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
                    </svg>
                    Téléchargements
                </div>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-header">Explorateur</div>
                <div class="tree-view" id="folder-tree">
                    <!-- Tree view will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Main content area -->
        <div class="main-content">
            <!-- Navigation bar -->
            <div class="navbar">
                <div class="nav-button" id="nav-back" title="Retour (Alt+Flèche gauche)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
                    </svg>
                </div>
                <div class="nav-button disabled" id="nav-forward" title="Avancer (Alt+Flèche droite)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" />
                    </svg>
                </div>
                <div class="nav-button" id="nav-up" title="Niveau supérieur (Alt+Flèche haut)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z" />
                    </svg>
                </div>
                <div class="breadcrumb" id="path-breadcrumb">
                    <!-- Breadcrumb will be populated by JavaScript -->
                </div>
                <div class="search-box">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                    </svg>
                    <input type="text" placeholder="Rechercher" id="search-input">
                </div>
            </div>

            <!-- Files container -->
            <div class="files-container" id="files-container">
                <!-- Files will be populated by JavaScript -->
            </div>

            <!-- Dropzone for file uploads -->
            <div class="dropzone" id="dropzone">
                Déposez vos fichiers ici
            </div>
        </div>
    </div>

    <!-- Status bar -->
    <div class="status-bar">
        <div class="status-left">
            <span id="selected-count">0 élément sélectionné</span>
        </div>
        <div class="status-right">
            <span id="total-count">0 éléments</span>
        </div>
    </div>

    <!-- Context menu -->
    <div class="context-menu" id="context-menu">
        <div class="menu-item" data-action="open">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" />
            </svg>
            Ouvrir
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="cut">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z" />
            </svg>
            Couper
        </div>
        <div class="menu-item" data-action="copy">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
            </svg>
            Copier
        </div>
        <div class="menu-item" data-action="paste">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z" />
            </svg>
            Coller
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="rename">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M18.41,5.8L17.2,4.59C16.41,3.8 15.14,3.8 14.34,4.59L4.59,14.34L3,17.75V21H6.25L9.66,19.41L19.41,9.66C20.2,8.86 20.2,7.59 19.41,6.8M6.92,19H5V17.08L6.17,16.67L7.33,17.83L6.92,19M5.95,15.18L7.82,17.05L16.07,8.8L14.2,6.93L5.95,15.18Z" />
            </svg>
            Renommer
        </div>
        <div class="menu-item" data-action="delete">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
            </svg>
            Supprimer
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="new-folder">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M10,4L12,6H20A2,2 0 0,1 22,8V18A2,2 0 0,1 20,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10M15,9V12H12V14H15V17H17V14H20V12H17V9H15Z" />
            </svg>
            Nouveau dossier
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="properties">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
            </svg>
            Propriétés
        </div>
    </div>

    <!-- Dialogs -->
    <div class="dialog-overlay" id="dialog-overlay">
        <div class="dialog" id="dialog">
            <div class="dialog-title" id="dialog-title">Titre de la boîte de dialogue</div>
            <div class="dialog-content" id="dialog-content">
                Contenu de la boîte de dialogue
            </div>
            <div class="dialog-buttons">
                <button class="dialog-button secondary" id="dialog-cancel">Annuler</button>
                <button class="dialog-button primary" id="dialog-confirm">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Notification container -->
    <div class="notification-container" id="notification-container">
        <!-- Notifications will be added here dynamically -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        /* --- Configuration GitHub (reprend la logique page 404) --- */
        const ENCRYPTION_KEY = "TroupeSaintElme2025";
        const encryptedData = {
            githubToken: "U2FsdGVkX18bflIPTYoKWYCFcJFneYp3xcwtgiHr90CLkbqlQOcfanBT7V1580l1RR5QFvZHXPxpHghmzzwUPc8pw7VN1W/Y+pOTRO0J4OfZx23zkkqmayC7/2EqfRvthq+OkDLXg1v7QsSqLjgzqQ==",
            githubOwner: "U2FsdGVkX186j9ffhpnA1a9MJtRiIa/04ShDXl5sbNQ=",
            githubRepo: "U2FsdGVkX19Zfsoi64wXtZeYZ3LTFaved+N7Qx6X6sdPw7IlmTc4/tOAKOkGPcHv",
            githubBranch: "U2FsdGVkX18dk0LRwjtJUNSytvcU62mMHrQE7rv8WUQ="
        };
        function decrypt(encryptedText) {
            try {
                return CryptoJS.AES.decrypt(encryptedText, ENCRYPTION_KEY).toString(CryptoJS.enc.Utf8);
            } catch (e) { return null; }
        }
        function getSecureValue(key) {
            if (!encryptedData[key]) return null;
            return decrypt(encryptedData[key]);
        }
        const GITHUB_TOKEN = getSecureValue('githubToken');
        const GITHUB_OWNER = getSecureValue('githubOwner') || "javabatchcss";
        const GITHUB_REPO = getSecureValue('githubRepo') || "Troupe-Saint-Elme";
        const GITHUB_BRANCH = getSecureValue('githubBranch') || "main";

        /* --- Récupération de l'arborescence GitHub (identique page 404) --- */
        async function fetchAllGithubFilesV3() {
            let owner = GITHUB_OWNER.trim();
            let repo = GITHUB_REPO.trim();
            let branch = GITHUB_BRANCH.trim();
            let triedBranches = [branch];
            if (branch === "main") triedBranches.push("master");
            else if (branch === "master") triedBranches.push("main");
            else triedBranches.push("main", "master");
            let branchData = null, sha = null;
            for (const tryBranch of triedBranches) {
                const branchUrl = `https://api.github.com/repos/${owner}/${repo}/branches/${tryBranch}`;
                try {
                    const branchResp = await fetch(branchUrl, {
                        headers: GITHUB_TOKEN ? { Authorization: `token ${GITHUB_TOKEN}` } : {}
                    });
                    if (branchResp.ok) {
                        branchData = await branchResp.json();
                        break;
                    }
                } catch (e) {}
            }
            if (!branchData) return [];
            if (branchData.commit && branchData.commit.commit && branchData.commit.commit.tree && branchData.commit.commit.tree.sha) {
                sha = branchData.commit.commit.tree.sha;
            } else if (branchData.commit && branchData.commit.tree && branchData.commit.tree.sha) {
                sha = branchData.commit.tree.sha;
            } else if (branchData.commit && branchData.commit.sha) {
                const commitUrl = `https://api.github.com/repos/${owner}/${repo}/git/commits/${branchData.commit.sha}`;
                try {
                    const commitResp = await fetch(commitUrl, {
                        headers: GITHUB_TOKEN ? { Authorization: `token ${GITHUB_TOKEN}` } : {}
                    });
                    if (commitResp.ok) {
                        const commitData = await commitResp.json();
                        if (commitData.tree && commitData.tree.sha) {
                            sha = commitData.tree.sha;
                        }
                    }
                } catch (e) {}
            }
            if (!sha) return [];
            const treeUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${sha}?recursive=1`;
            try {
                const treeResp = await fetch(treeUrl, {
                    headers: GITHUB_TOKEN ? { Authorization: `token ${GITHUB_TOKEN}` } : {}
                });
                if (!treeResp.ok) return [];
                const treeData = await treeResp.json();
                return treeData.tree || [];
            } catch (e) { return []; }
        }

        function buildTree(items) {
            const root = {};
            items.forEach(item => {
                const parts = item.path.split('/');
                let current = root;
                for (let i = 0; i < parts.length; i++) {
                    const part = parts[i];
                    if (i === parts.length - 1) {
                        if (item.type === "blob") {
                            current[part] = { __file: true, path: item.path, size: item.size, sha: item.sha };
                        } else if (item.type === "tree") {
                            current[part] = current[part] || {};
                        }
                    } else {
                        current[part] = current[part] || {};
                        current = current[part];
                    }
                }
            });
            return root;
        }

        function getNodeByPath(tree, parts) {
            let node = tree;
            for (const part of parts) {
                if (node && node[part]) node = node[part];
                else return {};
            }
            return node;
        }

        function getItemsAtPath(path) {
            if (!githubTreeReady) return [];
            const parts = path.split('/').filter(Boolean);
            let node = githubTree;
            if (parts.length > 0) node = getNodeByPath(githubTree, parts);
            if (!node) return [];
            const items = [];
            for (const key of Object.keys(node)) {
                const value = node[key];
                if (value && value.__file) {
                    items.push({
                        type: 'file',
                        name: key,
                        path: (path === '/' ? '/' : path + '/') + key,
                        size: value.size,
                        sha: value.sha
                    });
                } else {
                    items.push({
                        type: 'directory',
                        name: key,
                        path: (path === '/' ? '/' : path + '/') + key
                    });
                }
            }
            return items;
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            switch (ext) {
                case "html": case "htm": return "🌐";
                case "css": return "🎨";
                case "js": case "mjs": case "cjs": return "📜";
                case "json": return "🗄️";
                case "jpg": case "jpeg": case "png": case "gif": case "bmp": case "svg": case "webp": return "🖼️";
                case "pdf": return "📄";
                case "doc": case "docx": return "📝";
                case "xls": case "xlsx": return "📊";
                case "ppt": case "pptx": return "📈";
                case "zip": case "rar": case "7z": case "tar": case "gz": return "🗜️";
                case "mp3": case "wav": case "ogg": return "🎵";
                case "mp4": case "avi": case "mov": case "webm": case "mkv": return "🎬";
                case "md": return "📘";
                case "txt": return "📄";
                default: return "📄";
            }
        }
        function formatSize(size) {
            if (!size && size !== 0) return "";
            if (size < 1024) return size + " o";
            if (size < 1024 * 1024) return (size / 1024).toFixed(1) + " Ko";
            return (size / (1024 * 1024)).toFixed(2) + " Mo";
        }

        /* --- Modification réelle des fichiers du dépôt (token obligatoire) --- */
        async function renameFileOnGithub(oldPath, newPath, sha) {
            if (!GITHUB_TOKEN) {
                alert("Aucun token GitHub configuré. Impossible de modifier le dépôt.");
                return false;
            }
            // 1. Récupérer le contenu du fichier
            const getUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents${oldPath}`;
            const getResp = await fetch(getUrl, {
                headers: { Authorization: `token ${GITHUB_TOKEN}` }
            });
            if (!getResp.ok) return false;
            const fileData = await getResp.json();
            // 2. Créer le fichier à la nouvelle destination
            const putUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents${newPath}`;
            const putResp = await fetch(putUrl, {
                method: "PUT",
                headers: { "Content-Type": "application/json", Authorization: `token ${GITHUB_TOKEN}` },
                body: JSON.stringify({
                    message: `Renommage de ${oldPath} vers ${newPath}`,
                    content: fileData.content,
                    branch: GITHUB_BRANCH
                })
            });
            if (!putResp.ok) return false;
            // 3. Supprimer l'ancien fichier
            const delResp = await fetch(getUrl, {
                method: "DELETE",
                headers: { "Content-Type": "application/json", Authorization: `token ${GITHUB_TOKEN}` },
                body: JSON.stringify({
                    message: `Suppression de ${oldPath} après renommage`,
                    sha: fileData.sha,
                    branch: GITHUB_BRANCH
                })
            });
            return delResp.ok;
        }

        async function deleteFileOnGithub(path, sha) {
            if (!GITHUB_TOKEN) {
                alert("Aucun token GitHub configuré. Impossible de modifier le dépôt.");
                return false;
            }
            const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents${path}`;
            const resp = await fetch(url, {
                method: "DELETE",
                headers: { "Content-Type": "application/json", Authorization: `token ${GITHUB_TOKEN}` },
                body: JSON.stringify({
                    message: `Suppression de ${path}`,
                    sha: sha,
                    branch: GITHUB_BRANCH
                })
            });
            return resp.ok;
        }

        async function uploadFileOnGithub(path, contentBase64) {
            if (!GITHUB_TOKEN) {
                alert("Aucun token GitHub configuré. Impossible de modifier le dépôt.");
                return false;
            }
            const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents${path}`;
            const resp = await fetch(url, {
                method: "PUT",
                headers: { "Content-Type": "application/json", Authorization: `token ${GITHUB_TOKEN}` },
                body: JSON.stringify({
                    message: `Ajout de ${path}`,
                    content: contentBase64,
                    branch: GITHUB_BRANCH
                })
            });
            return resp.ok;
        }

        /* --- UI : navigation, affichage, édition --- */
        let githubTree = null;
        let githubFlatList = [];
        let githubTreeReady = false;
        const state = {
            currentPath: '/',
            history: ['/'],
            historyIndex: 0,
            selectedItems: new Set(),
            searchQuery: ''
        };

        async function loadGithubExplorer() {
            document.getElementById('files-container').innerHTML = '<div style="text-align:center;padding:40px;">Chargement des fichiers du dépôt...</div>';
            githubFlatList = await fetchAllGithubFilesV3();
            if (!githubFlatList.length) {
                document.getElementById('files-container').innerHTML = '<div style="color:#e74c3c;text-align:center;padding:40px;">Impossible de charger les fichiers du dépôt.</div>';
                return;
            }
            const filtered = githubFlatList.filter(item => item.type === "blob" || item.type === "tree");
            githubTree = buildTree(filtered);
            githubTreeReady = true;
            state.currentPath = '/';
            state.history = ['/'];
            state.historyIndex = 0;
            state.selectedItems = new Set();
            renderFiles();
            renderBreadcrumb();
            renderFolderTree();
            updateStatusBar();
        }

        function renderFiles() {
            const filesContainer = document.getElementById('files-container');
            filesContainer.innerHTML = '';
            if (!githubTreeReady) {
                filesContainer.innerHTML = '<div style="text-align:center;padding:40px;">Chargement...</div>';
                return;
            }
            let items = getItemsAtPath(state.currentPath);
            if (state.searchQuery) {
                items = items.filter(item => item.name.toLowerCase().includes(state.searchQuery.toLowerCase()));
            }
            items.sort((a, b) => {
                if (a.type !== b.type) return a.type === 'directory' ? -1 : 1;
                return a.name.localeCompare(b.name, 'fr', {sensitivity: 'base'});
            });
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'file-item' + (state.selectedItems.has(item.path) ? ' selected' : '');
                div.dataset.path = item.path;
                div.draggable = true;
                div.innerHTML = `
                    <div class="file-icon">${item.type === 'directory' ? '📁' : getFileIcon(item.name)}</div>
                    <div class="file-name">${item.name}</div>
                    ${item.type === 'file' && item.size ? `<div style="font-size:10px;color:#888;">${formatSize(item.size)}</div>` : ''}
                `;
                // Double-clic pour ouvrir dossier ou fichier
                div.ondblclick = () => {
                    if (item.type === 'directory') {
                        goToPath(item.path);
                    } else {
                        window.open(`https://github.com/${GITHUB_OWNER}/${GITHUB_REPO}/blob/${GITHUB_BRANCH}${item.path}`, '_blank');
                    }
                };
                // Sélection
                div.onclick = (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        if (state.selectedItems.has(item.path)) state.selectedItems.delete(item.path);
                        else state.selectedItems.add(item.path);
                    } else {
                        state.selectedItems.clear();
                        state.selectedItems.add(item.path);
                    }
                    renderFiles();
                    updateStatusBar();
                };
                // Renommage (F2)
                div.onkeydown = (e) => {
                    if (e.key === 'F2') startRename(item.path);
                };
                // Menu contextuel (clic droit)
                div.oncontextmenu = (e) => {
                    e.preventDefault();
                    showContextMenu(item, e.pageX, e.pageY);
                };
                filesContainer.appendChild(div);
            });
            document.getElementById('total-count').textContent = items.length + ' élément' + (items.length > 1 ? 's' : '');
        }

        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('path-breadcrumb');
            breadcrumb.innerHTML = '';
            const parts = state.currentPath.split('/').filter(Boolean);
            let path = '';
            const rootCrumb = document.createElement('span');
            rootCrumb.className = 'breadcrumb-item';
            rootCrumb.dataset.path = '/';
            rootCrumb.textContent = 'Accueil';
            rootCrumb.onclick = () => goToPath('/');
            breadcrumb.appendChild(rootCrumb);
            let currentPath = '';
            parts.forEach((part, i) => {
                currentPath += '/' + part;
                const sep = document.createElement('span');
                sep.className = 'breadcrumb-separator';
                sep.textContent = '>';
                breadcrumb.appendChild(sep);
                const crumb = document.createElement('span');
                crumb.className = 'breadcrumb-item';
                crumb.dataset.path = currentPath;
                crumb.textContent = part;
                crumb.onclick = () => goToPath(currentPath);
                breadcrumb.appendChild(crumb);
            });
        }

        function renderFolderTree() {
            // Affiche l'arborescence réduite dans la sidebar
            const folderTree = document.getElementById('folder-tree');
            function buildTreeHtml(obj, path = '/') {
                let html = '';
                for (const key in obj) {
                    const item = obj[key];
                    if (item && !item.__file) {
                        html += `<div class="tree-item${state.currentPath === (path === '/' ? '/' + key : path + '/' + key) ? ' active' : ''}" data-path="${path === '/' ? '/' + key : path + '/' + key}">
                            <span class="tree-icon">📁</span>${key}
                        </div>`;
                        html += `<div class="tree-children">${buildTreeHtml(item, path === '/' ? '/' + key : path + '/' + key)}</div>`;
                    }
                }
                return html;
            }
            folderTree.innerHTML = buildTreeHtml(githubTree || {});
            folderTree.querySelectorAll('.tree-item').forEach(el => {
                el.onclick = () => goToPath(el.dataset.path);
            });
        }

        function updateStatusBar() {
            document.getElementById('selected-count').textContent = state.selectedItems.size + ' élément sélectionné' + (state.selectedItems.size > 1 ? 's' : '');
        }

        function goToPath(path) {
            if (state.currentPath !== path) {
                state.currentPath = path;
                state.history = state.history.slice(0, state.historyIndex + 1);
                state.history.push(path);
                state.historyIndex = state.history.length - 1;
                state.selectedItems.clear();
                renderFiles();
                renderBreadcrumb();
                updateStatusBar();
            }
        }

        // Menu contextuel (clic droit)
        function showContextMenu(item, x, y) {
            const menu = document.getElementById('context-menu');
            menu.style.display = 'block';
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';
            // Actions
            menu.querySelector('[data-action="open"]').onclick = () => {
                if (item.type === 'directory') goToPath(item.path);
                else window.open(`https://github.com/${GITHUB_OWNER}/${GITHUB_REPO}/blob/${GITHUB_BRANCH}${item.path}`, '_blank');
                menu.style.display = 'none';
            };
            menu.querySelector('[data-action="rename"]').onclick = () => {
                startRename(item.path);
                menu.style.display = 'none';
            };
            menu.querySelector('[data-action="delete"]').onclick = () => {
                startDelete(item.path);
                menu.style.display = 'none';
            };
            document.body.onclick = () => { menu.style.display = 'none'; };
        }

        // Renommage
        async function startRename(path) {
            const items = getItemsAtPath(state.currentPath);
            const item = items.find(i => i.path === path);
            if (!item || item.type !== "file") return;
            const newName = prompt("Nouveau nom pour le fichier :", item.name);
            if (!newName || newName === item.name) return;
            const newPath = path.split('/').slice(0, -1).join('/') + '/' + newName;
            const ok = await renameFileOnGithub(path, newPath, item.sha);
            if (ok) {
                alert("Fichier renommé !");
                await loadGithubExplorer();
            } else {
                alert("Erreur lors du renommage.");
            }
        }

        // Suppression
        async function startDelete(path) {
            const items = getItemsAtPath(state.currentPath);
            const item = items.find(i => i.path === path);
            if (!item || item.type !== "file") return;
            if (!confirm("Supprimer ce fichier ?")) return;
            const ok = await deleteFileOnGithub(path, item.sha);
            if (ok) {
                alert("Fichier supprimé !");
                await loadGithubExplorer();
            } else {
                alert("Erreur lors de la suppression.");
            }
        }

        // Drag & drop pour upload
        document.getElementById('dropzone').addEventListener('dragover', (e) => {
            e.preventDefault();
            document.getElementById('dropzone').classList.add('active');
        });
        document.getElementById('dropzone').addEventListener('dragleave', (e) => {
            document.getElementById('dropzone').classList.remove('active');
        });
        document.getElementById('dropzone').addEventListener('drop', async (e) => {
            e.preventDefault();
            document.getElementById('dropzone').classList.remove('active');
            const files = Array.from(e.dataTransfer.files);
            for (const file of files) {
                const reader = new FileReader();
                reader.onload = async function(ev) {
                    const contentBase64 = btoa(ev.target.result);
                    const path = state.currentPath + (state.currentPath.endsWith('/') ? '' : '/') + file.name;
                    const ok = await uploadFileOnGithub(path, contentBase64);
                    if (ok) {
                        alert("Fichier ajouté !");
                        await loadGithubExplorer();
                    } else {
                        alert("Erreur lors de l'ajout.");
                    }
                };
                reader.readAsBinaryString(file);
            }
        });

        // Recherche
        document.getElementById('search-input').addEventListener('input', (e) => {
            state.searchQuery = e.target.value.trim();
            renderFiles();
            updateStatusBar();
        });

        // Navigation historique
        document.getElementById('nav-back').onclick = () => {
            if (state.historyIndex > 0) {
                state.historyIndex--;
                state.currentPath = state.history[state.historyIndex];
                state.selectedItems.clear();
                renderFiles();
                renderBreadcrumb();
                updateStatusBar();
            }
        };
        document.getElementById('nav-forward').onclick = () => {
            if (state.historyIndex < state.history.length - 1) {
                state.historyIndex++;
                state.currentPath = state.history[state.historyIndex];
                state.selectedItems.clear();
                renderFiles();
                renderBreadcrumb();
                updateStatusBar();
            }
        };
        document.getElementById('nav-up').onclick = () => {
            const parent = state.currentPath.split('/').slice(0, -1).join('/') || '/';
            if (parent !== state.currentPath) goToPath(parent);
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            loadGithubExplorer();
        });
    </script>
</body>
</html>

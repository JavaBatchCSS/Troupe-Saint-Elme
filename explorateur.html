<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorateur de fichiers - Troupe Saint Elme</title>
    <link rel="icon" href="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --bg-main: #f5f5f5;
            --bg-header: #f0f0f0;
            --border-color: #dadada;
            --hover-color: #e5f3ff;
            --select-color: #cce8ff;
            --accent-color: #3498db;
            --text-color: #333;
            --text-light: #888;
            --menu-bg: white;
            --menu-hover: #f0f0f0;
            --icon-size: 20px;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header & Ribbon */
        .header {
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            display: flex;
            align-items: center;
            height: 40px;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }

        .logo img {
            height: 28px;
            margin-right: 8px;
        }

        .logo h1 {
            font-size: 16px;
            font-weight: normal;
        }

        .ribbon {
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 4px 10px;
            height: 56px;
            display: flex;
            flex-direction: column;
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 5px;
        }

        .tab {
            padding: 3px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 13px;
        }

        .tab:hover {
            background-color: var(--hover-color);
        }

        .tab.active {
            background-color: var(--select-color);
        }

        .toolbar {
            display: flex;
            gap: 10px;
        }

        .toolbar-group {
            display: flex;
            border-right: 1px solid var(--border-color);
            padding-right: 10px;
            margin-right: 10px;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 11px;
            padding: 2px 5px;
            border-radius: 3px;
            cursor: pointer;
        }

        .toolbar-button:hover {
            background-color: var(--hover-color);
        }

        .toolbar-button svg {
            height: var(--icon-size);
            width: var(--icon-size);
            margin-bottom: 2px;
        }

        /* Main container */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 200px;
            min-width: 120px;
            max-width: 400px;
            resize: horizontal;
            overflow-x: auto;
            background-color: var(--bg-main);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 10px 0;
            transition: width 0.2s;
        }

        .sidebar-details-panel {
            border-top: 1px solid var(--border-color);
            background: #f8f8f8;
            padding: 8px 10px;
            font-size: 12px;
            color: #444;
            min-height: 60px;
            max-height: 200px;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 10px;
        }

        .sidebar-header {
            padding: 5px 10px;
            font-weight: bold;
            font-size: 13px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 13px;
        }

        .sidebar-item:hover {
            background-color: var(--hover-color);
        }

        .sidebar-item.active {
            background-color: var(--select-color);
        }

        .sidebar-item svg {
            margin-right: 8px;
            height: 16px;
            width: 16px;
        }

        /* Navigation bar */
        .navbar {
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            display: flex;
            align-items: center;
            height: 40px;
            flex-wrap: nowrap;
            gap: 5px;
        }

        .nav-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 3px;
            cursor: pointer;
        }

        .nav-button:hover {
            background-color: var(--hover-color);
        }

        .nav-button svg {
            height: 16px;
            width: 16px;
        }

        .nav-button.disabled {
            opacity: 0.5;
            cursor: default;
        }

        .nav-button.disabled:hover {
            background-color: transparent;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 0 5px;
            height: 30px;
            flex: 1;
            overflow: hidden;
            background-color: white;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0 5px;
            border-radius: 3px;
            white-space: nowrap;
        }

        .breadcrumb-item:hover {
            background-color: var(--hover-color);
        }

        .breadcrumb-separator {
            margin: 0 5px;
            color: var(--text-light);
        }

        .search-box {
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 0 5px;
            height: 30px;
            width: 200px;
            background-color: white;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            padding: 0 5px;
            font-size: 13px;
        }

        .search-box svg {
            height: 16px;
            width: 16px;
            color: var(--text-light);
        }

        /* File explorer main area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .files-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            grid-gap: 10px;
            align-content: start;
        }

        .file-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
            text-align: center;
            height: 100px;
            position: relative;
        }

        .file-item:hover {
            background-color: var(--hover-color);
        }

        .file-item.selected {
            background-color: var(--select-color);
        }

        .file-icon {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .file-name {
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            word-break: break-word;
            max-height: 36px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .file-item input {
            width: 100%;
            border: 1px solid var(--accent-color);
            outline: none;
            padding: 2px;
            font-size: 12px;
            position: absolute;
            bottom: 5px;
            text-align: center;
        }

        /* Status bar */
        .status-bar {
            background-color: var(--bg-header);
            border-top: 1px solid var(--border-color);
            padding: 3px 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            height: 24px;
        }

        .status-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Context menu */
        .context-menu {
            position: absolute;
            background-color: var(--menu-bg);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 5px 0;
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 13px;
        }

        .menu-item:hover {
            background-color: var(--menu-hover);
        }

        .menu-item svg {
            margin-right: 8px;
            height: 16px;
            width: 16px;
        }

        .menu-separator {
            height: 1px;
            background-color: var(--border-color);
            margin: 5px 0;
        }

        /* Dropzone */
        .dropzone {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(52, 152, 219, 0.2);
            border: 3px dashed var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--accent-color);
            z-index: 999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .dropzone.active {
            opacity: 1;
        }

        /* Dialogs */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            display: none;
        }

        .dialog {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 400px;
            padding: 20px;
        }

        .dialog-title {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .dialog-content {
            margin-bottom: 20px;
        }

        .dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dialog-button {
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .dialog-button.primary {
            background-color: var(--accent-color);
            color: white;
        }

        .dialog-button.secondary {
            background-color: var(--bg-header);
            color: var(--text-color);
        }

        /* List view */
        .list-view {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .list-header {
            display: flex;
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            font-weight: bold;
            font-size: 13px;
        }

        .list-column {
            flex: 1;
            padding: 5px;
        }

        .list-column.name {
            flex: 2;
        }

        .list-item {
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding: 5px 10px;
            cursor: pointer;
        }

        .list-item:hover {
            background-color: var(--hover-color);
        }

        .list-item.selected {
            background-color: var(--select-color);
        }

        .list-cell {
            flex: 1;
            padding: 5px;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-cell.name {
            flex: 2;
            display: flex;
            align-items: center;
        }

        .list-cell svg, .list-cell .file-type-icon {
            margin-right: 5px;
            height: 16px;
            width: 16px;
            flex-shrink: 0;
        }

        /* Popup notifications */
        .notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 2000;
        }

        .notification {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s, fadeOut 0.5s 4.5s;
            max-width: 300px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .notification svg {
            height: 20px;
            width: 20px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-light);
        }

        .notification.info svg {
            color: var(--accent-color);
        }

        .notification.success svg {
            color: #27ae60;
        }

        .notification.error svg {
            color: #e74c3c;
        }

        .notification.warning svg {
            color: #f39c12;
        }

        .drag-image {
            position: absolute;
            pointer-events: none;
            z-index: 1001;
            opacity: 0.7;
            display: flex;
            align-items: center;
            background-color: var(--select-color);
            padding: 5px 10px;
            border-radius: 3px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 13px;
        }

        .drag-image svg {
            margin-right: 5px;
            height: 16px;
            width: 16px;
        }

        .detail-view {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        /* Tree view in sidebar */
        .tree-view {
            padding-left: 10px;
        }
        
        .tree-item {
            display: flex;
            align-items: center;
            padding: 2px 5px;
            cursor: pointer;
            font-size: 13px;
            position: relative;
        }
        
        .tree-item:hover {
            background-color: var(--hover-color);
        }
        
        .tree-item.active {
            background-color: var(--select-color);
        }
        
        .tree-toggle {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 2px;
            font-size: 10px;
        }

        .tree-icon {
            margin-right: 5px;
        }
        
        .tree-children {
            padding-left: 15px;
            display: none;
        }
        
        .tree-children.expanded {
            display: block;
        }

        .iframe-modal {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.92);
            z-index: 5000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .iframe-modal-content {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 30px #222;
            max-width: 95vw;
            max-height: 95vh;
            width: 90vw;
            height: 90vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .iframe-modal-header {
            padding: 10px 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8f8f8;
        }
        .iframe-modal-close {
            font-size: 1.5em;
            background: none;
            border: none;
            cursor: pointer;
        }
        .iframe-modal-iframe {
            flex: 1;
            width: 100%;
            border: none;
            min-height: 0;
        }
    </style>
</head>
<body>
    <!-- Header with logo -->
    <div class="header">
        <div class="logo">
            <img src="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png" alt="Logo">
            <h1>Explorateur de fichiers - Troupe Saint Elme</h1>
        </div>
    </div>

    <!-- Ribbon with tabs and toolbar -->
    <div class="ribbon">
        <div class="tabs">
            <div class="tab active">Accueil</div>
            <div class="tab">Partager</div>
            <div class="tab">Affichage</div>
        </div>
        <div class="toolbar">
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-cut" data-action="cut" title="Couper (Ctrl+X)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z" />
                    </svg>
                    Couper
                </div>
                <div class="toolbar-button" id="btn-copy" data-action="copy" title="Copier (Ctrl+C)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
                    </svg>
                    Copier
                </div>
                <div class="toolbar-button" id="btn-paste" data-action="paste" title="Coller (Ctrl+V)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z" />
                    </svg>
                    Coller
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-upload" data-action="upload" title="Importer">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z" />
                    </svg>
                    Importer
                </div>
                <div class="toolbar-button" id="btn-new-folder" data-action="new-folder" title="Nouveau dossier">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M10,4L12,6H20A2,2 0 0,1 22,8V18A2,2 0 0,1 20,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10M15,9V12H12V14H15V17H17V14H20V12H17V9H15Z" />
                    </svg>
                    Nouveau dossier
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-rename" data-action="rename" title="Renommer (F2)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M18.41,5.8L17.2,4.59C16.41,3.8 15.14,3.8 14.34,4.59L4.59,14.34L3,17.75V21H6.25L9.66,19.41L19.41,9.66C20.2,8.86 20.2,7.59 19.41,6.8M6.92,19H5V17.08L6.17,16.67L7.33,17.83L6.92,19M5.95,15.18L7.82,17.05L16.07,8.8L14.2,6.93L5.95,15.18Z" />
                    </svg>
                    Renommer
                </div>
                <div class="toolbar-button" id="btn-delete" data-action="delete" title="Supprimer (Suppr)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                    </svg>
                    Supprimer
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-undo" data-action="undo" title="Annuler (Ctrl+Z)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z" />
                    </svg>
                    Annuler
                </div>
                <div class="toolbar-button" id="btn-redo" data-action="redo" title="R√©tablir (Ctrl+Y)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z" />
                    </svg>
                    R√©tablir
                </div>
            </div>
            <div class="toolbar-group">
                <div class="toolbar-button" id="btn-view-toggle" data-action="view-toggle" title="Changer de vue">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"></path>
                    </svg>
                    <span style="font-size:11px;">Affichage</span>
                </div>
                <div class="toolbar-button" id="btn-refresh" data-action="refresh" title="Actualiser (F5)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
                    </svg>
                    Actualiser
                </div>
            </div>
        </div>
    </div>

    <!-- Main container with sidebar and content -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-header">Acc√®s rapide</div>
                <div class="sidebar-item" data-path="/">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" />
                    </svg>
                    Accueil
                </div>
                <div class="sidebar-item" data-path="/documents">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z" />
                    </svg>
                    Documents
                </div>
                <div class="sidebar-item" data-path="/images">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z" />
                    </svg>
                    Images
                </div>
                <div class="sidebar-item" data-path="/videos">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z" />
                    </svg>
                    Vid√©os
                </div>
                <div class="sidebar-item" data-path="/music">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M21,3V15.5A3.5,3.5 0 0,1 17.5,19A3.5,3.5 0 0,1 14,15.5A3.5,3.5 0 0,1 17.5,12C18.04,12 18.55,12.12 19,12.34V6.47L9,8.6V17.5A3.5,3.5 0 0,1 5.5,21A3.5,3.5 0 0,1 2,17.5A3.5,3.5 0 0,1 5.5,14C6.04,14 6.55,14.12 7,14.34V6L21,3Z" />
                    </svg>
                    Musique
                </div>
                <div class="sidebar-item" data-path="/downloads">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
                    </svg>
                    T√©l√©chargements
                </div>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-header">Explorateur</div>
                <div class="tree-view" id="folder-tree">
                    <!-- Tree view will be populated by JavaScript -->
                </div>
            </div>
            <div class="sidebar-details-panel" id="sidebar-details-panel" style="display:none;">
                <!-- D√©tails du fichier s√©lectionn√© -->
            </div>
        </div>

        <!-- Main content area -->
        <div class="main-content">
            <!-- Navigation bar -->
            <div class="navbar">
                <div class="nav-button" id="nav-back" title="Retour (Alt+Fl√®che gauche)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
                    </svg>
                </div>
                <div class="nav-button disabled" id="nav-forward" title="Avancer (Alt+Fl√®che droite)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" />
                    </svg>
                </div>
                <div class="nav-button" id="nav-up" title="Niveau sup√©rieur (Alt+Fl√®che haut)">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z" />
                    </svg>
                </div>
                <div class="breadcrumb" id="path-breadcrumb">
                    <!-- Breadcrumb will be populated by JavaScript -->
                </div>
                <div class="search-box">
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                    </svg>
                    <input type="text" placeholder="Rechercher" id="search-input">
                </div>
            </div>

            <!-- Files container -->
            <div class="files-container" id="files-container">
                <!-- Files will be populated by JavaScript -->
            </div>

            <!-- Dropzone for file uploads -->
            <div class="dropzone" id="dropzone">
                D√©posez vos fichiers ici
            </div>
        </div>
    </div>

    <!-- Status bar -->
    <div class="status-bar">
        <div class="status-left">
            <span id="selected-count">0 √©l√©ment s√©lectionn√©</span>
        </div>
        <div class="status-right">
            <span id="total-count">0 √©l√©ments</span>
        </div>
    </div>

    <!-- Context menu -->
    <div class="context-menu" id="context-menu">
        <div class="menu-item" data-action="open">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" />
            </svg>
            Ouvrir
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="cut">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z" />
            </svg>
            Couper
        </div>
        <div class="menu-item" data-action="copy">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
            </svg>
            Copier
        </div>
        <div class="menu-item" data-action="paste">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z" />
            </svg>
            Coller
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="rename">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M18.41,5.8L17.2,4.59C16.41,3.8 15.14,3.8 14.34,4.59L4.59,14.34L3,17.75V21H6.25L9.66,19.41L19.41,9.66C20.2,8.86 20.2,7.59 19.41,6.8M6.92,19H5V17.08L6.17,16.67L7.33,17.83L6.92,19M5.95,15.18L7.82,17.05L16.07,8.8L14.2,6.93L5.95,15.18Z" />
            </svg>
            Renommer
        </div>
        <div class="menu-item" data-action="delete">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
            </svg>
            Supprimer
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="new-folder">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M10,4L12,6H20A2,2 0 0,1 22,8V18A2,2 0 0,1 20,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10M15,9V12H12V14H15V17H17V14H20V12H17V9H15Z" />
            </svg>
            Nouveau dossier
        </div>
        <div class="menu-separator"></div>
        <div class="menu-item" data-action="properties">
            <svg viewBox="0 0 24 24">
                <path fill="currentColor" d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
            </svg>
            Propri√©t√©s
        </div>
    </div>

    <!-- Dialogs -->
    <div class="dialog-overlay" id="dialog-overlay">
        <div class="dialog" id="dialog">
            <div class="dialog-title" id="dialog-title">Titre de la bo√Æte de dialogue</div>
            <div class="dialog-content" id="dialog-content">
                Contenu de la bo√Æte de dialogue
            </div>
            <div class="dialog-buttons">
                <button class="dialog-button secondary" id="dialog-cancel">Annuler</button>
                <button class="dialog-button primary" id="dialog-confirm">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Notification container -->
    <div class="notification-container" id="notification-container">
        <!-- Notifications will be added here dynamically -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        /* --- Configuration GitHub (reprend la logique page 404) --- */
        const ENCRYPTION_KEY = "TroupeSaintElme2025";
        const encryptedData = {
            githubToken: "U2FsdGVkX18bflIPTYoKWYCFcJFneYp3xcwtgiHr90CLkbqlQOcfanBT7V1580l1RR5QFvZHXPxpHghmzzwUPc8pw7VN1W/Y+pOTRO0J4OfZx23zkkqmayC7/2EqfRvthq+OkDLXg1v7QsSqLjgzqQ==",
            githubOwner: "U2FsdGVkX186j9ffhpnA1a9MJtRiIa/04ShDXl5sbNQ=",
            githubRepo: "U2FsdGVkX19Zfsoi64wXtZeYZ3LTFaved+N7Qx6X6sdPw7IlmTc4/tOAKOkGPcHv",
            githubBranch: "U2FsdGVkX18dk0LRwjtJUNSytvcU62mMHrQE7rv8WUQ="
        };
        function decrypt(encryptedText) {
            try {
                return CryptoJS.AES.decrypt(encryptedText, ENCRYPTION_KEY).toString(CryptoJS.enc.Utf8);
            } catch (e) { return null; }
        }
        function getSecureValue(key) {
            if (!encryptedData[key]) return null;
            return decrypt(encryptedData[key]);
        }
        const GITHUB_TOKEN = getSecureValue('githubToken');
        const GITHUB_OWNER = getSecureValue('githubOwner') || "javabatchcss";
        const GITHUB_REPO = getSecureValue('githubRepo') || "Troupe-Saint-Elme";
        const GITHUB_BRANCH = getSecureValue('githubBranch') || "master";

        /* --- R√©cup√©ration de l'arborescence GitHub (identique page 404) --- */
        async function fetchAllGithubFilesV3() {
            let owner = GITHUB_OWNER.trim();
            let repo = GITHUB_REPO.trim();
            let branch = GITHUB_BRANCH.trim();
            let triedBranches = [branch];
            if (branch === "main") triedBranches.push("master");
            else if (branch === "master") triedBranches.push("main");
            else triedBranches.push("main", "master");
            let branchData = null, sha = null;
            for (const tryBranch of triedBranches) {
                const branchUrl = `https://api.github.com/repos/${owner}/${repo}/branches/${tryBranch}`;
                try {
                    const branchResp = await fetch(branchUrl, {
                        headers: GITHUB_TOKEN ? { Authorization: `token ${GITHUB_TOKEN}` } : {}
                    });
                    if (branchResp.ok) {
                        branchData = await branchResp.json();
                        break;
                    }
                } catch (e) {}
            }
            if (!branchData) return [];
            if (branchData.commit && branchData.commit.commit && branchData.commit.commit.tree && branchData.commit.commit.tree.sha) {
                sha = branchData.commit.commit.tree.sha;
            } else if (branchData.commit && branchData.commit.tree && branchData.commit.tree.sha) {
                sha = branchData.commit.tree.sha;
            } else if (branchData.commit && branchData.commit.sha) {
                const commitUrl = `https://api.github.com/repos/${owner}/${repo}/git/commits/${branchData.commit.sha}`;
                try {
                    const commitResp = await fetch(commitUrl, {
                        headers: GITHUB_TOKEN ? { Authorization: `token ${GITHUB_TOKEN}` } : {}
                    });
                    if (commitResp.ok) {
                        const commitData = await commitResp.json();
                        if (commitData.tree && commitData.tree.sha) {
                            sha = commitData.tree.sha;
                        }
                    }
                } catch (e) {}
            }
            if (!sha) return [];
            const treeUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${sha}?recursive=1`;
            try {
                const treeResp = await fetch(treeUrl, {
                    headers: GITHUB_TOKEN ? { Authorization: `token ${GITHUB_TOKEN}` } : {}
                });
                if (!treeResp.ok) return [];
                const treeData = await treeResp.json();
                return treeData.tree || [];
            } catch (e) { return []; }
        }

        function buildTree(items) {
            const root = {};
            items.forEach(item => {
                const parts = item.path.split('/');
                let current = root;
                for (let i = 0; i < parts.length; i++) {
                    const part = parts[i];
                    if (i === parts.length - 1) {
                        if (item.type === "blob") {
                            current[part] = { __file: true, path: item.path, size: item.size, sha: item.sha };
                        } else if (item.type === "tree") {
                            current[part] = current[part] || {};
                        }
                    } else {
                        current[part] = current[part] || {};
                        current = current[part];
                    }
                }
            });
            return root;
        }

        function getNodeByPath(tree, parts) {
            let node = tree;
            for (const part of parts) {
                if (node && node[part]) node = node[part];
                else return {};
            }
            return node;
        }

        function getItemsAtPath(path) {
            if (!githubTreeReady) return [];
            const parts = path.split('/').filter(Boolean);
            let node = githubTree;
            if (parts.length > 0) node = getNodeByPath(githubTree, parts);
            if (!node) return [];
            const items = [];
            for (const key of Object.keys(node)) {
                const value = node[key];
                if (value && value.__file) {
                    items.push({
                        type: 'file',
                        name: key,
                        path: (path === '/' ? '/' : path + '/') + key,
                        size: value.size,
                        sha: value.sha
                    });
                } else {
                    items.push({
                        type: 'directory',
                        name: key,
                        path: (path === '/' ? '/' : path + '/') + key
                    });
                }
            }
            return items;
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            switch (ext) {
                case "html": case "htm": return "üåê";
                case "css": return "üé®";
                case "js": case "mjs": case "cjs": return "üìú";
                case "json": return "üóÑÔ∏è";
                case "jpg": case "jpeg": case "png": case "gif": case "bmp": case "svg": case "webp": return "üñºÔ∏è";
                case "pdf": return "üìÑ";
                case "doc": case "docx": return "üìù";
                case "xls": case "xlsx": return "üìä";
                case "ppt": case "pptx": return "üìà";
                case "zip": case "rar": case "7z": case "tar": case "gz": return "üóúÔ∏è";
                case "mp3": case "wav": case "ogg": return "üéµ";
                case "mp4": case "avi": case "mov": case "webm": case "mkv": return "üé¨";
                case "md": return "üìò";
                case "txt": return "üìÑ";
                default: return "üìÑ";
            }
        }
        function formatSize(size) {
            if (!size && size !== 0) return "";
            if (size < 1024) return size + " o";
            if (size < 1024 * 1024) return (size / 1024).toFixed(1) + " Ko";
            return (size / (1024 * 1024)).toFixed(2) + " Mo";
        }

        function getRawUrl(path) {
            // URL brute pour visualisation directe (sans interface GitHub)
            return `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}${path}`;
        }
        function getHtmlPreviewUrl(path) {
            // Pour HTML, CSS, JS, PNG, JPG, etc. : visualisation navigateur
            // Pour un site GitHub Pages, on peut pointer sur le site public
            // (adapter selon votre structure)
            return `https://javabatchcss.github.io/Troupe-Saint-Elme${path}`;
        }

        /* --- Modification r√©elle des fichiers du d√©p√¥t (token obligatoire) --- */
        async function renameFileOnGithub(oldPath, newPath, currentFileSha) {
            if (!GITHUB_TOKEN) {
                showNotification("Aucun token GitHub configur√©. Impossible de modifier le d√©p√¥t.", "error");
                return false;
            }
            // Retirer le '/' initial pour l'API
            const oldApiPath = oldPath.startsWith('/') ? oldPath.substring(1) : oldPath;
            const newApiPath = newPath.startsWith('/') ? newPath.substring(1) : newPath;
            try {
                // 1. Obtenir le contenu de l'ancien fichier
                const getUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${oldApiPath}`;
                const getResp = await fetch(getUrl, {
                    headers: { Authorization: `token ${GITHUB_TOKEN}`, "Accept": "application/vnd.github.v3+json" }
                });
                if (!getResp.ok) {
                    const errorData = await getResp.json().catch(() => ({ message: getResp.statusText }));
                    showNotification(`Erreur lors de la lecture de '${oldPath}' (${getResp.status}): ${errorData.message}`, "error");
                    return false;
                }
                const fileData = await getResp.json();
                if (fileData.type !== 'file') {
                    showNotification(`L'√©l√©ment '${oldPath}' n'est pas un fichier. Renommage de dossiers non support√©.`, "error");
                    return false;
                }
                const contentBase64 = fileData.content;

                // 2. Cr√©er le nouveau fichier
                const createUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${newApiPath}`;
                const createResp = await fetch(createUrl, {
                    method: "PUT",
                    headers: { 
                        "Content-Type": "application/json", 
                        Authorization: `token ${GITHUB_TOKEN}`, 
                        "Accept": "application/vnd.github.v3+json" 
                    },
                    body: JSON.stringify({
                        message: `Renommage: ${oldPath} -> ${newPath} (cr√©ation nouveau)`,
                        content: contentBase64,
                        branch: GITHUB_BRANCH
                    })
                });
                if (!createResp.ok) {
                    const errorData = await createResp.json().catch(() => ({ message: createResp.statusText }));
                    showNotification(`Erreur lors de la cr√©ation de '${newPath}' (${createResp.status}): ${errorData.message}`, "error");
                    return false;
                }

                // 3. Supprimer l'ancien fichier
                const deleteUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${oldApiPath}`;
                const deleteResp = await fetch(deleteUrl, {
                    method: "DELETE",
                    headers: { 
                        "Content-Type": "application/json", 
                        Authorization: `token ${GITHUB_TOKEN}`,
                        "Accept": "application/vnd.github.v3+json" 
                    },
                    body: JSON.stringify({
                        message: `Renommage: ${oldPath} -> ${newPath} (suppression ancien)`,
                        sha: fileData.sha, 
                        branch: GITHUB_BRANCH
                    })
                });
                if (!deleteResp.ok) {
                    const errorData = await deleteResp.json().catch(() => ({ message: deleteResp.statusText }));
                    showNotification(`Fichier '${newPath}' cr√©√©, mais erreur lors de la suppression de '${oldPath}' (${deleteResp.status}): ${errorData.message}. Veuillez v√©rifier.`, "warning");
                    return false;
                }
                return true;
            } catch (e) {
                showNotification(`Erreur r√©seau lors du renommage de '${oldPath}': ${e.message}`, "error");
                return false;
            }
        }

        async function deleteFileOnGithub(path, sha) {
            if (!GITHUB_TOKEN) {
                showNotification("Aucun token GitHub configur√©. Impossible de modifier le d√©p√¥t.", "error");
                return false;
            }
            // Le chemin pour l'API ne doit pas commencer par '/'
            const apiPath = path.startsWith('/') ? path.substring(1) : path;
            const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${apiPath}`;
            try {
                const resp = await fetch(url, {
                    method: "DELETE",
                    headers: { 
                        "Content-Type": "application/json", 
                        Authorization: `token ${GITHUB_TOKEN}`,
                        "Accept": "application/vnd.github.v3+json" 
                    },
                    body: JSON.stringify({
                        message: `Suppression: ${path}`,
                        sha: sha,
                        branch: GITHUB_BRANCH
                    })
                });
                if (resp.ok) {
                    return true;
                } else {
                    const errorData = await resp.json().catch(() => ({ message: resp.statusText }));
                    showNotification(`Erreur lors de la suppression de '${path}' (${resp.status}): ${errorData.message}`, "error");
                    return false;
                }
            } catch (e) {
                showNotification(`Erreur r√©seau lors de la suppression de '${path}': ${e.message}`, "error");
                return false;
            }
        }

        async function uploadFileOnGithub(path, contentBase64) {
            if (!GITHUB_TOKEN) {
                showNotification("Aucun token GitHub configur√©. Impossible de modifier le d√©p√¥t.", "error");
                return false;
            }
            // Corriger le chemin pour l'API en retirant le '/' initial
            const apiPath = path.startsWith('/') ? path.substring(1) : path;
            const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${apiPath}`;
            let sha = null;
            try {
                const getResp = await fetch(url, {
                    headers: { Authorization: `token ${GITHUB_TOKEN}`, "Accept": "application/vnd.github.v3+json" }
                });
                if (getResp.ok) {
                    const fileData = await getResp.json();
                    sha = fileData.sha;
                } else if (getResp.status !== 404) {
                    const errorData = await getResp.json().catch(() => ({}));
                    showNotification(`Erreur lors de la v√©rification de '${path}' (${getResp.status}): ${errorData.message || getResp.statusText}`, "error");
                    return false;
                }
            } catch (e) {
                showNotification(`Erreur r√©seau lors de la v√©rification de '${path}': ${e.message}`, "error");
                return false;
            }
            const requestBody = {
                message: sha ? `Mise √† jour: ${path}` : `Ajout: ${path}`,
                content: contentBase64,
                branch: GITHUB_BRANCH
            };
            if (sha) {
                requestBody.sha = sha;
            }
            try {
                const putResp = await fetch(url, {
                    method: "PUT",
                    headers: { 
                        "Content-Type": "application/json", 
                        Authorization: `token ${GITHUB_TOKEN}`,
                        "Accept": "application/vnd.github.v3+json" 
                    },
                    body: JSON.stringify(requestBody)
                });
                if (putResp.ok) {
                    return true;
                } else {
                    const errorData = await putResp.json().catch(() => ({}));
                    showNotification(`Erreur lors de l'upload de '${path}' (${putResp.status}): ${errorData.message || putResp.statusText}`, "error");
                    console.error("Erreur d'upload:", path, putResp.status, errorData);
                    return false;
                }
            } catch (e) {
                showNotification(`Erreur r√©seau lors de l'upload de '${path}': ${e.message}`, "error");
                return false;
            }
        }

        /* --- UI : navigation, affichage, √©dition --- */
        let githubTree = null;
        let githubFlatList = [];
        let githubTreeReady = false;
        const state = {
            currentPath: '/',
            history: ['/'],
            historyIndex: 0,
            selectedItems: new Set(),
            searchQuery: ''
        };

        async function loadGithubExplorer() {
            document.getElementById('files-container').innerHTML = '<div style="text-align:center;padding:40px;">Chargement des fichiers du d√©p√¥t...</div>';
            githubFlatList = await fetchAllGithubFilesV3();
            if (!githubFlatList.length) {
                document.getElementById('files-container').innerHTML = '<div style="color:#e74c3c;text-align:center;padding:40px;">Impossible de charger les fichiers du d√©p√¥t.</div>';
                return;
            }
            const filtered = githubFlatList.filter(item => item.type === "blob" || item.type === "tree");
            githubTree = buildTree(filtered);
            githubTreeReady = true;
            state.currentPath = '/';
            state.history = ['/'];
            state.historyIndex = 0;
            state.selectedItems = new Set();
            renderFiles();
            renderBreadcrumb();
            renderFolderTree();
            updateStatusBar();
        }

        // D√©tection des fichiers visualisables dans le navigateur
        function isVisualizableFile(name) {
            const ext = name.split('.').pop().toLowerCase();
            return ['html', 'htm', 'jpg', 'jpeg', 'png', 'gif', 'svg', 'webp', 'bmp', 'mp4', 'webm', 'mp3', 'wav', 'ogg', 'pdf'].includes(ext);
        }

        // --- Pr√©visualisation images et galerie ---
        let galleryImages = [];
        let galleryIndex = 0;

        function showImageGallery(images, startIndex) {
            // Cr√©e la galerie si elle n'existe pas
            let gallery = document.getElementById('image-gallery');
            if (!gallery) {
                gallery = document.createElement('div');
                gallery.id = 'image-gallery';
                gallery.style.position = 'fixed';
                gallery.style.top = '0';
                gallery.style.left = '0';
                gallery.style.width = '100vw';
                gallery.style.height = '100vh';
                gallery.style.background = 'rgba(0,0,0,0.95)';
                gallery.style.display = 'flex';
                gallery.style.flexDirection = 'column';
                gallery.style.alignItems = 'center';
                gallery.style.justifyContent = 'center';
                gallery.style.zIndex = '3000';
                gallery.innerHTML = `
                    <button id="gallery-close" style="position:absolute;top:20px;right:30px;font-size:2em;color:white;background:none;border:none;cursor:pointer;">‚úñ</button>
                    <button id="gallery-prev" style="position:absolute;left:30px;top:50%;transform:translateY(-50%);font-size:2em;color:white;background:none;border:none;cursor:pointer;">‚óÄ</button>
                    <img id="gallery-img" style="max-width:80vw;max-height:80vh;border-radius:8px;box-shadow:0 0 30px #222;">
                    <button id="gallery-next" style="position:absolute;right:30px;top:50%;transform:translateY(-50%);font-size:2em;color:white;background:none;border:none;cursor:pointer;">‚ñ∂</button>
                    <div id="gallery-caption" style="color:white;margin-top:20px;font-size:1.2em;"></div>
                `;
                document.body.appendChild(gallery);
                document.getElementById('gallery-close').onclick = () => { gallery.style.display = 'none'; };
                document.getElementById('gallery-prev').onclick = () => { showGalleryImage(galleryIndex - 1); };
                document.getElementById('gallery-next').onclick = () => { showGalleryImage(galleryIndex + 1); };
            }
            galleryImages = images;
            galleryIndex = startIndex;
            showGalleryImage(galleryIndex);
            gallery.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        function showGalleryImage(index) {
            if (!galleryImages.length) return;
            galleryIndex = (index + galleryImages.length) % galleryImages.length;
            const img = document.getElementById('gallery-img');
            const caption = document.getElementById('gallery-caption');
            img.src = getHtmlPreviewUrl(galleryImages[galleryIndex].path);
            caption.textContent = galleryImages[galleryIndex].name;
        }

        // --- Vue d√©taill√©e / liste / ic√¥nes ---
        let viewMode = 'icons'; // 'icons', 'list', 'details'

        function setViewMode(mode) {
            viewMode = mode;
            renderFiles();
            // Met √† jour l'√©tat visuel des boutons si besoin
            document.querySelectorAll('.toolbar-button[data-view-mode]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.viewMode === mode);
            });
        }

        // Ajout des boutons de vue dans la toolbar
        document.addEventListener('DOMContentLoaded', () => {
            const btnViewToggle = document.getElementById('btn-view-toggle');
            if (btnViewToggle) {
                // Ic√¥ne Windows "Affichage" (grille)
                btnViewToggle.innerHTML = `
                    <svg viewBox="0 0 24 24">
                        <path fill="currentColor" d="M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"></path>
                    </svg>
                    <span style="font-size:11px;">Affichage</span>
                `;
                // Cycle entre icons -> list -> details
                btnViewToggle.onclick = () => {
                    if (viewMode === 'icons') setViewMode('list');
                    else if (viewMode === 'list') setViewMode('details');
                    else setViewMode('icons');
                };
            }
        });

        // --- Modification du comportement d'ouverture de fichier ---
        function openFile(item) {
            const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp', 'bmp'];
            const ext = item.name.split('.').pop().toLowerCase();
            if (imageExts.includes(ext)) {
                // Ouvre la galerie d'images du dossier courant
                const items = getItemsAtPath(state.currentPath);
                const images = items.filter(i => i.type === 'file' && imageExts.includes(i.name.split('.').pop().toLowerCase()));
                const idx = images.findIndex(i => i.path === item.path);
                showImageGallery(images, idx >= 0 ? idx : 0);
            } else if (['html', 'htm', 'pdf', 'mp4', 'webm', 'mp3', 'wav', 'ogg'].includes(ext)) {
                window.open(getHtmlPreviewUrl(item.path), '_blank');
            } else {
                // Ouvre dans vscode.dev
                window.open(`https://vscode.dev/github/${GITHUB_OWNER}/${GITHUB_REPO}/blob/${GITHUB_BRANCH}${item.path}`, '_blank');
            }
        }

        // --- Modification de renderFiles pour supporter les vues et la pr√©visualisation image ---
        function renderFiles() {
            const filesContainer = document.getElementById('files-container');
            filesContainer.innerHTML = '';
            if (!githubTreeReady) {
                filesContainer.innerHTML = '<div style="text-align:center;padding:40px;">Chargement...</div>';
                return;
            }
            let items = getItemsAtPath(state.currentPath);
            if (state.searchQuery) {
                items = items.filter(item => item.name.toLowerCase().includes(state.searchQuery.toLowerCase()));
            }
            items.sort((a, b) => {
                if (a.type !== b.type) return a.type === 'directory' ? -1 : 1;
                return a.name.localeCompare(b.name, 'fr', {sensitivity: 'base'});
            });

            if (viewMode === 'icons') {
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'file-item' + (state.selectedItems.has(item.path) ? ' selected' : '');
                    div.dataset.path = item.path;
                    div.draggable = true;
                    let preview = '';
                    if (item.type === 'file' && ['jpg','jpeg','png','gif','webp','bmp'].includes(item.name.split('.').pop().toLowerCase())) {
                        preview = `<img src="${getHtmlPreviewUrl(item.path)}" style="max-width:48px;max-height:48px;border-radius:4px;margin-bottom:4px;box-shadow:0 0 6px #ccc;">`;
                    }
                    div.innerHTML = `
                        <div class="file-icon">${item.type === 'directory' ? 'üìÅ' : preview || getFileIcon(item.name)}</div>
                        <div class="file-name">${item.name}</div>
                        ${item.type === 'file' && item.size ? `<div style="font-size:10px;color:#888;">${formatSize(item.size)}</div>` : ''}
                    `;
                    div.ondblclick = () => {
                        if (item.type === 'directory') goToPath(item.path);
                        else openFile(item);
                    };
                    div.onclick = (e) => handleSelection(item, e);
                    div.ondragstart = (e) => {
                        dragItem = div;
                        dragSourcePath = item.path;
                        e.dataTransfer.effectAllowed = "move";
                        e.dataTransfer.setData("text/plain", item.path);
                    };
                    div.ondragend = () => {
                        dragItem = null;
                        dragSourcePath = null;
                    };
                    div.oncontextmenu = (e) => {
                        e.preventDefault();
                        showContextMenu(item, e.pageX, e.pageY);
                    };
                    filesContainer.appendChild(div);
                });
            } else if (viewMode === 'list') {
                items.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'list-item' + (state.selectedItems.has(item.path) ? ' selected' : '');
                    row.dataset.path = item.path;
                    row.draggable = true;
                    let preview = '';
                    if (item.type === 'file' && ['jpg','jpeg','png','gif','webp','bmp'].includes(item.name.split('.').pop().toLowerCase())) {
                        preview = `<img src="${getHtmlPreviewUrl(item.path)}" style="max-width:24px;max-height:24px;border-radius:3px;margin-right:4px;">`;
                    }
                    row.innerHTML = `
                        <div class="list-cell name">${item.type === 'directory' ? 'üìÅ' : preview || getFileIcon(item.name)} ${item.name}</div>
                    `;
                    row.ondblclick = () => {
                        if (item.type === 'directory') goToPath(item.path);
                        else openFile(item);
                    };
                    row.onclick = (e) => handleSelection(item, e);
                    row.ondragstart = (e) => {
                        dragItem = row;
                        dragSourcePath = item.path;
                        e.dataTransfer.effectAllowed = "move";
                        e.dataTransfer.setData("text/plain", item.path);
                    };
                    row.ondragend = () => {
                        dragItem = null;
                        dragSourcePath = null;
                    };
                    row.oncontextmenu = (e) => {
                        e.preventDefault();
                        showContextMenu(item, e.pageX, e.pageY);
                    };
                    filesContainer.appendChild(row);
                });
            } else if (viewMode === 'details') {
                const table = document.createElement('table');
                table.style.width = '100%';
                table.style.borderCollapse = 'collapse';
                const thead = document.createElement('thead');
                thead.innerHTML = `
                    <tr style="background:#f0f0f0;">
                        <th style="text-align:left;padding:6px;">Nom</th>
                        <th style="text-align:left;padding:6px;">Type</th>
                        <th style="text-align:left;padding:6px;">Taille</th>
                    </tr>
                `;
                table.appendChild(thead);
                const tbody = document.createElement('tbody');
                items.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.className = (state.selectedItems.has(item.path) ? 'selected' : '');
                    tr.style.cursor = 'pointer';
                    let preview = '';
                    if (item.type === 'file' && ['jpg','jpeg','png','gif','webp','bmp'].includes(item.name.split('.').pop().toLowerCase())) {
                        preview = `<img src="${getHtmlPreviewUrl(item.path)}" style="max-width:18px;max-height:18px;border-radius:2px;margin-right:4px;vertical-align:middle;">`;
                    }
                    tr.innerHTML = `
                        <td style="padding:6px;">${item.type === 'directory' ? 'üìÅ' : preview || getFileIcon(item.name)} ${item.name}</td>
                        <td style="padding:6px;">${item.type}</td>
                        <td style="padding:6px;">${item.size ? formatSize(item.size) : ''}</td>
                    `;
                    tr.ondblclick = () => {
                        if (item.type === 'directory') goToPath(item.path);
                        else openFile(item);
                    };
                    tr.onclick = (e) => handleSelection(item, e);
                    tr.oncontextmenu = (e) => {
                        e.preventDefault();
                        showContextMenu(item, e.pageX, e.pageY);
                    };
                    tbody.appendChild(tr);
                });
                table.appendChild(tbody);
                filesContainer.appendChild(table);
            }
            document.getElementById('total-count').textContent = items.length + ' √©l√©ment' + (items.length > 1 ? 's' : '');
            enableFilesDragDrop();
            updateSidebarDetailsPanel();
        }

        // Chemin de la corbeille (dossier sp√©cial √† la racine du d√©p√¥t)
        const TRASH_PATH = "/.corbeille";

        // --- D√©placement r√©el d'un fichier ou dossier sur GitHub (support drag & drop et suppression vers corbeille) ---
        async function moveFileOrFolder(srcPath, destDirPath) {
            pushUndoState();
            if (!GITHUB_TOKEN) {
                alert("Aucun token GitHub configur√©. Impossible de modifier le d√©p√¥t.");
                return false;
            }
            const items = getItemsAtPath(srcPath.substring(0, srcPath.lastIndexOf('/')) || '/');
            const item = items.find(i => i.path === srcPath);
            if (!item) return false;
            let newPath = destDirPath + '/' + item.name;
            if (item.type === 'file') {
                const ok = await renameFileOnGithub(srcPath, newPath, item.sha);
                if (ok) {
                    await loadGithubExplorer();
                } else {
                    alert("Erreur lors du d√©placement.");
                }
            } else if (item.type === 'directory') {
                await moveDirectoryRecursive(srcPath, destDirPath + '/' + item.name);
                await loadGithubExplorer();
            }
        }

        // D√©placement r√©cursif d'un dossier (copie tous les fichiers puis supprime l'ancien dossier)
        async function moveDirectoryRecursive(srcDir, destDir) {
            const items = getItemsAtPath(srcDir);
            for (const item of items) {
                if (item.type === 'file') {
                    await renameFileOnGithub(item.path, destDir + '/' + item.name, item.sha);
                } else if (item.type === 'directory') {
                    await moveDirectoryRecursive(item.path, destDir + '/' + item.name);
                }
            }
        }

        // --- Drag & Drop pour d√©placer les fichiers dans l'arborescence et depuis la vue principale ---
        let dragItem = null;
        let dragSourcePath = null;

        function enableSidebarTreeDragDrop() {
            document.querySelectorAll('.tree-item').forEach(el => {
                el.draggable = true;
                el.ondragstart = (e) => {
                    dragItem = el;
                    dragSourcePath = el.dataset.path;
                    e.dataTransfer.effectAllowed = "move";
                    e.dataTransfer.setData("text/plain", el.dataset.path);
                };
                el.ondragover = (e) => {
                    e.preventDefault();
                    el.classList.add('drag-over');
                };
                el.ondragleave = (e) => {
                    el.classList.remove('drag-over');
                };
                el.ondrop = async (e) => {
                    e.preventDefault();
                    el.classList.remove('drag-over');
                    const src = dragSourcePath || e.dataTransfer.getData("text/plain");
                    if (!src || src === el.dataset.path) return;
                    await moveFileOrFolder(src, el.dataset.path);
                    dragItem = null;
                    dragSourcePath = null;
                };
                el.ondragend = () => {
                    document.querySelectorAll('.tree-item').forEach(e => e.classList.remove('drag-over'));
                    dragItem = null;
                    dragSourcePath = null;
                };
            });
        }

        // --- Drag & Drop sur toute la zone fichiers : d√©placer dans n'importe quel dossier ---
        function enableFilesDragDrop() {
            // On permet le drag sur tous les √©l√©ments
            document.querySelectorAll('.file-item, .list-item').forEach(el => {
                el.draggable = true;
                el.ondragstart = (e) => {
                    dragItem = el;
                    dragSourcePath = el.dataset.path;
                    e.dataTransfer.effectAllowed = "move";
                    e.dataTransfer.setData("text/plain", el.dataset.path);
                };
                el.ondragend = () => {
                    document.querySelectorAll('.file-item, .list-item').forEach(e => e.classList.remove('drag-over'));
                    dragItem = null;
                    dragSourcePath = null;
                };
            });
            // On permet le drop uniquement sur les dossiers
            document.querySelectorAll('.file-item, .list-item').forEach(el => {
                const path = el.dataset.path;
                const isDir = el.innerHTML.includes('üìÅ') || (el.querySelector('.file-icon') && el.querySelector('.file-icon').textContent === 'üìÅ');
                if (isDir) {
                    el.ondragover = (e) => {
                        e.preventDefault();
                        el.classList.add('drag-over');
                    };
                    el.ondragleave = (e) => {
                        el.classList.remove('drag-over');
                    };
                    el.ondrop = async (e) => {
                        e.preventDefault();
                        el.classList.remove('drag-over');
                        const src = dragSourcePath || e.dataTransfer.getData("text/plain");
                        if (!src || src === path) return;
                        await moveFileOrFolder(src, path);
                        dragItem = null;
                        dragSourcePath = null;
                    };
                }
                el.ondragend = () => {
                    document.querySelectorAll('.file-item, .list-item').forEach(e => e.classList.remove('drag-over'));
                    dragItem = null;
                    dragSourcePath = null;
                };
            });
        }

        // --- Modification du comportement d'ouverture de fichier et drag depuis la vue principale ---
        // --- Suppression : d√©place dans la corbeille au lieu de supprimer ---
        async function startDelete(path) {
            pushUndoState();
            const parentPath = path.substring(0, path.lastIndexOf('/')) || '/';
            const items = getItemsAtPath(parentPath);
            const item = items.find(i => i.path === path);
            if (!item) return;
            if (!confirm("D√©placer cet √©l√©ment dans la corbeille ?")) return;
            const trashFilePath = TRASH_PATH + '/' + item.name;
            if (item.type === "file") {
                const ok = await renameFileOnGithub(path, trashFilePath, item.sha);
                if (ok) {
                    alert("Fichier d√©plac√© dans la corbeille !");
                    await loadGithubExplorer();
                } else {
                    alert("Erreur lors du d√©placement dans la corbeille.");
                }
            } else if (item.type === "directory") {
                await moveDirectoryRecursive(path, TRASH_PATH + '/' + item.name);
                await loadGithubExplorer();
            }
        }

        // --- T√©l√©versement de fichiers (drag & drop ou s√©lection multiple) ---
        document.getElementById('dropzone').addEventListener('dragover', (e) => {
            e.preventDefault();
            document.getElementById('dropzone').classList.add('active');
        });
        document.getElementById('dropzone').addEventListener('dragleave', (e) => {
            document.getElementById('dropzone').classList.remove('active');
        });
        document.getElementById('dropzone').addEventListener('drop', async (e) => {
            e.preventDefault();
            document.getElementById('dropzone').classList.remove('active');
            const files = Array.from(e.dataTransfer.files);
            for (const file of files) {
                const reader = new FileReader();
                reader.onload = async function(ev) {
                    const contentBase64 = arrayBufferToBase64(ev.target.result);
                    const path = state.currentPath + (state.currentPath.endsWith('/') ? '' : '/') + file.name;
                    const ok = await uploadFileOnGithub(path, contentBase64);
                    if (ok) {
                        alert("Fichier ajout√© !");
                        await loadGithubExplorer();
                    } else {
                        alert("Erreur lors de l'ajout.");
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        });

        // Ajout d'un input file pour s√©lection multiple et dossiers (webkitdirectory)
        if (!document.getElementById('file-upload-input')) {
            const input = document.createElement('input');
            input.type = 'file';
            input.id = 'file-upload-input';
            input.multiple = true;
            input.style.display = 'none';
            input.webkitdirectory = true; // Permet l'upload de dossiers entiers (Chrome/Edge)
            input.onchange = async function(e) {
                const files = Array.from(e.target.files);
                for (const file of files) {
                    // Pour les dossiers, file.webkitRelativePath contient le chemin relatif
                    let relPath = file.webkitRelativePath || file.name;
                    let destPath = state.currentPath + (state.currentPath.endsWith('/') ? '' : '/') + relPath;
                    // Nettoyage du chemin si d√©j√† inclus
                    if (destPath.startsWith('//')) destPath = destPath.replace('//', '/');
                    const reader = new FileReader();
                    reader.onload = async function(ev) {
                        const contentBase64 = arrayBufferToBase64(ev.target.result);
                        const ok = await uploadFileOnGithub(destPath, contentBase64);
                        if (!ok) {
                            alert("Erreur lors de l'ajout de " + relPath);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                }
                setTimeout(loadGithubExplorer, 1000);
            };
            document.body.appendChild(input);
        }
        // Ajout bouton "Importer" pour ouvrir le s√©lecteur de fichiers/dossiers
        const btnUpload = document.getElementById('btn-upload');
        if (btnUpload) {
            btnUpload.onclick = () => {
                document.getElementById('file-upload-input').click();
            };
        }

        // Drag & drop sur la zone fichiers pour upload performant (fichiers et dossiers)
        document.getElementById('dropzone').addEventListener('dragover', (e) => {
            e.preventDefault();
            document.getElementById('dropzone').classList.add('active');
        });
        document.getElementById('dropzone').addEventListener('dragleave', (e) => {
            document.getElementById('dropzone').classList.remove('active');
        });
        document.getElementById('dropzone').addEventListener('drop', async (e) => {
            e.preventDefault();
            document.getElementById('dropzone').classList.remove('active');
            const items = e.dataTransfer.items;
            if (items && items.length && items[0].webkitGetAsEntry) {
                // Support dossiers (Chrome/Edge)
                for (let i = 0; i < items.length; i++) {
                    const entry = items[i].webkitGetAsEntry();
                    if (entry) await traverseFileTree(entry, state.currentPath);
                }
                setTimeout(loadGithubExplorer, 1000);
            } else {
                // Fallback fichiers simples
                const files = Array.from(e.dataTransfer.files);
                for (const file of files) {
                    const reader = new FileReader();
                    reader.onload = async function(ev) {
                        const contentBase64 = arrayBufferToBase64(ev.target.result);
                        const path = state.currentPath + (state.currentPath.endsWith('/') ? '' : '/') + file.name;
                        const ok = await uploadFileOnGithub(path, contentBase64);
                        if (!ok) alert("Erreur lors de l'ajout.");
                    };
                    reader.readAsArrayBuffer(file);
                }
                setTimeout(loadGithubExplorer, 1000);
            }
        });

        // Fonction r√©cursive pour upload dossiers (drag & drop)
        async function traverseFileTree(item, path) {
            return new Promise((resolve) => {
                if (item.isFile) {
                    item.file(async (file) => {
                        const relPath = path + (path.endsWith('/') ? '' : '/') + file.name;
                        const reader = new FileReader();
                        reader.onload = async function(ev) {
                            const contentBase64 = arrayBufferToBase64(ev.target.result);
                            await uploadFileOnGithub(relPath, contentBase64);
                            resolve();
                        };
                        reader.readAsArrayBuffer(file);
                    });
                } else if (item.isDirectory) {
                    const dirReader = item.createReader();
                    dirReader.readEntries(async (entries) => {
                        for (const entry of entries) {
                            await traverseFileTree(entry, path + (path.endsWith('/') ? '' : '/') + item.name);
                        }
                        resolve();
                    });
                } else {
                    resolve();
                }
            });
        }

        // --- Sidebar tree avec d√©veloppement/r√©duction dynamique ---
        function renderFolderTree() {
            const folderTree = document.getElementById('folder-tree');
            function buildTreeHtml(obj, path = '/', level = 0) {
                let html = '';
                for (const key in obj) {
                    const item = obj[key];
                    if (item && !item.__file) {
                        const fullPath = path === '/' ? '/' + key : path + '/' + key;
                        html += `<div class="tree-item${state.currentPath === fullPath ? ' active' : ''}" data-path="${fullPath}" style="padding-left:${level * 16}px;">
                            <span class="tree-toggle" onclick="toggleSidebarTreeExpand(event, '${fullPath}')">‚ñ∂Ô∏è</span>
                            <span class="tree-icon">üìÅ</span>${key}
                        </div>
                        <div class="tree-children" id="tree-children-${btoa(fullPath)}" style="display:none;"></div>`;
                    }
                }
                return html;
            }
            folderTree.innerHTML = buildTreeHtml(githubTree || {});
            // Navigation via sidebar
            folderTree.querySelectorAll('.tree-item').forEach(el => {
                el.onclick = (e) => {
                    if (!e.target.classList.contains('tree-toggle')) {
                        goToPath(el.dataset.path);
                    }
                };
            });
            enableSidebarTreeDragDrop();
            openTreeToCurrentPath();
        }

        // D√©veloppement/r√©duction dynamique de l'arborescence
        window.toggleSidebarTreeExpand = function(event, path) {
            event.stopPropagation();
            const childrenDiv = document.getElementById('tree-children-' + btoa(path));
            if (!childrenDiv) return;
            if (childrenDiv.innerHTML === '') {
                // Charger les enfants
                const parts = path.split('/').filter(Boolean);
                let node = githubTree;
                for (const part of parts) {
                    if (node && node[part]) node = node[part];
                    else return;
                }
                childrenDiv.innerHTML = renderFolderTreeChildren(node, path, (path.split('/').length));
                childrenDiv.style.display = 'block';
                event.target.textContent = '‚ñº';
                enableSidebarTreeDragDrop();
            } else if (childrenDiv.style.display === 'none') {
                childrenDiv.style.display = 'block';
                event.target.textContent = '‚ñº';
            } else {
                childrenDiv.style.display = 'none';
                event.target.textContent = '‚ñ∂Ô∏è';
            }
        };

        function renderFolderTreeChildren(obj, path, level) {
            let html = '';
            for (const key in obj) {
                const item = obj[key];
                if (item && !item.__file) {
                    const fullPath = path === '/' ? '/' + key : path + '/' + key;
                    html += `<div class="tree-item" data-path="${fullPath}" style="padding-left:${level * 16}px;">
                        <span class="tree-toggle" onclick="toggleSidebarTreeExpand(event, '${fullPath}')">‚ñ∂Ô∏è</span>
                        <span class="tree-icon">üìÅ</span>${key}
                    </div>
                    <div class="tree-children" id="tree-children-${btoa(fullPath)}" style="display:none;"></div>`;
                }
            }
            return html;
        }

        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('path-breadcrumb');
            breadcrumb.innerHTML = '';
            const parts = state.currentPath.split('/').filter(Boolean);
            let path = '';
            const rootCrumb = document.createElement('span');
            rootCrumb.className = 'breadcrumb-item';
            rootCrumb.dataset.path = '/';
            rootCrumb.textContent = 'Accueil';
            rootCrumb.onclick = () => goToPath('/');
            breadcrumb.appendChild(rootCrumb);
            let currentPath = '';
            parts.forEach((part, i) => {
                currentPath += '/' + part;
                const sep = document.createElement('span');
                sep.className = 'breadcrumb-separator';
                sep.textContent = '>';
                breadcrumb.appendChild(sep);
                const crumb = document.createElement('span');
                crumb.className = 'breadcrumb-item';
                crumb.dataset.path = currentPath;
                crumb.textContent = part;
                crumb.onclick = () => goToPath(currentPath);
                breadcrumb.appendChild(crumb);
            });
        }

        function updateStatusBar() {
            document.getElementById('selected-count').textContent = state.selectedItems.size + ' √©l√©ment s√©lectionn√©' + (state.selectedItems.size > 1 ? 's' : '');
        }

        function goToPath(path) {
            if (state.currentPath !== path) {
                state.currentPath = path;
                state.history = state.history.slice(0, state.historyIndex + 1);
                state.history.push(path);
                state.historyIndex = state.history.length - 1;
                state.selectedItems.clear();
                renderFiles();
                renderBreadcrumb();
                updateStatusBar();
            }
        }

        // Menu contextuel (clic droit) : "Ouvrir", "Ouvrir dans un nouvel onglet", "Ouvrir avec"
        function showContextMenu(item, x, y) {
            const menu = document.getElementById('context-menu');
            menu.style.display = 'block';
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';

            // Affiche/masque les actions selon le type
            menu.querySelector('[data-action="open"]').style.display = item.type === 'file' ? '' : 'none';
            menu.querySelector('[data-action="rename"]').style.display = item.type === 'file' ? '' : 'none';
            menu.querySelector('[data-action="delete"]').style.display = '';
            menu.querySelector('[data-action="new-folder"]').style.display = item.type === 'directory' ? '' : 'none';
            menu.querySelector('[data-action="properties"]').style.display = '';

            // Ajoute sous-menu "Ouvrir", "Ouvrir dans un nouvel onglet", "Ouvrir avec"
            let openMenu = menu.querySelector('[data-action="open"]');
            openMenu.innerHTML = `
                <svg viewBox="0 0 24 24"><path fill="currentColor" d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" /></svg>
                <span>Ouvrir</span>
                <div style="margin-left:20px;">
                    <button id="open-default" style="margin:2px 4px 2px 0;">Ouvrir</button>
                    <button id="open-newtab" style="margin:2px 4px 2px 0;">Ouvrir dans un nouvel onglet</button>
                    <button id="open-browser" style="margin:2px 4px 2px 0;">Ouvrir dans le navigateur</button>
                    <button id="open-with" style="margin:2px 0;">Ouvrir avec ‚ñº</button>
                    <div id="open-with-menu" style="display:none;position:absolute;left:120px;top:0;background:#fff;border:1px solid #ccc;z-index:1100;padding:4px 0;border-radius:4px;box-shadow:0 2px 8px #0002;">
                        <div class="menu-item" id="open-edge" style="padding:4px 16px;cursor:pointer;">Edge (iframe)</div>
                        <div class="menu-item" id="open-vscode" style="padding:4px 16px;cursor:pointer;">Visual Studio Code</div>
                        <div class="menu-item" id="open-text" style="padding:4px 16px;cursor:pointer;">√âditeur de texte</div>
                    </div>
                </div>
            `;
            openMenu.style.display = item.type === 'file' ? '' : 'none';

            setTimeout(() => {
                document.getElementById('open-default').onclick = (e) => {
                    e.stopPropagation();
                    openFile(item); // Use existing openFile logic
                    menu.style.display = 'none';
                };
                document.getElementById('open-newtab').onclick = (e) => {
                    e.stopPropagation();
                    // Directly open preview URL in a new tab
                    window.open(getHtmlPreviewUrl(item.path), '_blank');
                    menu.style.display = 'none';
                };
                document.getElementById('open-browser').onclick = (e) => {
                    e.stopPropagation();
                    window.open(getHtmlPreviewUrl(item.path), '_blank');
                    menu.style.display = 'none';
                };
                document.getElementById('open-with').onclick = (e) => {
                    e.stopPropagation();
                    const sub = document.getElementById('open-with-menu');
                    sub.style.display = sub.style.display === 'block' ? 'none' : 'block';
                };
                document.getElementById('open-edge').onclick = (e) => {
                    e.stopPropagation();
                    openInIframe(getHtmlPreviewUrl(item.path), item.name);
                    menu.style.display = 'none';
                };
                document.getElementById('open-vscode').onclick = (e) => {
                    e.stopPropagation();
                    // Ouvre sur github.dev (Visual Studio Code Web)
                    window.open(`https://github.dev/${GITHUB_OWNER}/${GITHUB_REPO}/blob/${GITHUB_BRANCH}${item.path}`, '_blank');
                    menu.style.display = 'none';
                };
                document.getElementById('open-text').onclick = async (e) => {
                    e.stopPropagation();
                    await openTextEditor(item);
                    menu.style.display = 'none';
                };
                document.body.onclick = () => {
                    menu.style.display = 'none';
                    document.getElementById('open-with-menu').style.display = 'none';
                };
            }, 10);
        }

        // --- Ouvre un fichier dans un iframe modal (Edge) ---
        function openInIframe(url, title) {
            let modal = document.getElementById('iframe-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'iframe-modal';
                modal.className = 'iframe-modal';
                modal.innerHTML = `
                    <div class="iframe-modal-content">
                        <div class="iframe-modal-header">
                            <span id="iframe-modal-title"></span>
                            <button class="iframe-modal-close" id="iframe-modal-close">‚úñ</button>
                        </div>
                        <iframe class="iframe-modal-iframe" id="iframe-modal-iframe"></iframe>
                    </div>
                `;
                document.body.appendChild(modal);
                document.getElementById('iframe-modal-close').onclick = () => {
                    modal.style.display = 'none';
                };
            }
            document.getElementById('iframe-modal-title').textContent = title;
            document.getElementById('iframe-modal-iframe').src = url;
            modal.style.display = 'flex';
        }

        // --- Ouvre dynamiquement l'arborescence jusqu'au dossier/fichier ouvert ---
        function openTreeToCurrentPath() {
            const parts = state.currentPath.split('/').filter(Boolean);
            let path = '';
            for (let i = 0; i < parts.length; i++) {
                path += '/' + parts[i];
                const toggle = document.querySelector(`.tree-item[data-path="${path}"] .tree-toggle`);
                if (toggle) {
                    const childrenDiv = document.getElementById('tree-children-' + btoa(path));
                    if (childrenDiv && childrenDiv.innerHTML === '') {
                        const node = getNodeByPath(githubTree, path.split('/').filter(Boolean));
                        childrenDiv.innerHTML = renderFolderTreeChildren(node, path, path.split('/').length);
                    }
                    childrenDiv.style.display = 'block';
                    toggle.textContent = '‚ñº';
                }
            }
            // Ouvre aussi le chemin jusqu'au fichier s√©lectionn√© si un fichier est ouvert
            if (state.selectedItems && state.selectedItems.size === 1) {
                const filePath = Array.from(state.selectedItems)[0];
                const fileParts = filePath.split('/').filter(Boolean);
                let filePathSoFar = '';
                for (let i = 0; i < fileParts.length - 1; i++) {
                    filePathSoFar += '/' + fileParts[i];
                    const toggle = document.querySelector(`.tree-item[data-path="${filePathSoFar}"] .tree-toggle`);
                    if (toggle) {
                        const childrenDiv = document.getElementById('tree-children-' + btoa(filePathSoFar));
                        if (childrenDiv && childrenDiv.innerHTML === '') {
                            const node = getNodeByPath(githubTree, filePathSoFar.split('/').filter(Boolean));
                            childrenDiv.innerHTML = renderFolderTreeChildren(node, filePathSoFar, filePathSoFar.split('/').length);
                        }
                        childrenDiv.style.display = 'block';
                        toggle.textContent = '‚ñº';
                    }
                }
            }
        }

        // --- S√©lection multiple avec Ctrl et Shift ---
        let lastSelectedPath = null;
        function handleSelection(item, e) {
            if (e.shiftKey && lastSelectedPath) {
                // S√©lection par plage
                const items = getItemsAtPath(state.currentPath);
                const paths = items.map(i => i.path);
                const lastIdx = paths.indexOf(lastSelectedPath);
                const currIdx = paths.indexOf(item.path);
                if (lastIdx !== -1 && currIdx !== -1) {
                    const [start, end] = [lastIdx, currIdx].sort((a, b) => a - b);
                    for (let i = start; i <= end; i++) {
                        state.selectedItems.add(paths[i]);
                    }
                }
            } else if (e.ctrlKey || e.metaKey) {
                if (state.selectedItems.has(item.path)) state.selectedItems.delete(item.path);
                else state.selectedItems.add(item.path);
                lastSelectedPath = item.path;
            } else {
                state.selectedItems.clear();
                state.selectedItems.add(item.path);
                lastSelectedPath = item.path;
            }
            renderFiles();
            updateStatusBar();
            updateSidebarDetailsPanel();
        }

        // --- Propri√©t√©s d√©taill√©es ---
        function showProperties(item) {
            let info = `Nom : ${item.name}\nType : ${item.type}`;
            if (item.size !== undefined) info += `\nTaille : ${formatSize(item.size)}`;
            if (item.type === 'directory') {
                const items = getItemsAtPath(item.path);
                const nbFiles = items.filter(i => i.type === 'file').length;
                const nbDirs = items.filter(i => i.type === 'directory').length;
                info += `\nContenu : ${nbFiles} fichier(s), ${nbDirs} dossier(s)`;
            }
            info += `\nChemin : ${item.path}`;
            alert(info);
        }

        // --- Raccourcis clavier ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Delete') {
                // Supprimer les √©l√©ments s√©lectionn√©s
                for (const path of state.selectedItems) startDelete(path);
            }
            if (e.key === 'F2' && state.selectedItems.size === 1) {
                startRename(Array.from(state.selectedItems)[0]);
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'a') {
                // S√©lectionner tout
                const items = getItemsAtPath(state.currentPath);
                state.selectedItems = new Set(items.map(i => i.path));
                renderFiles();
                updateStatusBar();
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'c') {
                // Copier (non impl√©ment√©, √† compl√©ter si besoin)
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'v') {
                // Coller (non impl√©ment√©, √† compl√©ter si besoin)
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'x') {
                // Couper (non impl√©ment√©, √† compl√©ter si besoin)
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'z') {
                undo();
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'y') {
                redo();
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'd') {
                // Ctrl+D : Ajoute √† la s√©lection l'√©l√©ment sous le curseur (si possible)
                const hover = document.querySelector('.file-item:hover, .list-item:hover');
                if (hover) {
                    state.selectedItems.add(hover.dataset.path);
                    renderFiles();
                    updateStatusBar();
                    updateSidebarDetailsPanel();
                }
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'f') {
                // Ctrl+F : focus recherche
                document.getElementById('search-input').focus();
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n') {
                // Ctrl+N : nouveau fichier
                startNewFile();
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'o') {
                // Ctrl+O : ouvrir le premier √©l√©ment s√©lectionn√©
                if (state.selectedItems.size > 0) {
                    const path = Array.from(state.selectedItems)[0];
                    const items = getItemsAtPath(state.currentPath);
                    const item = items.find(i => i.path === path);
                    if (item) openFile(item);
                }
                e.preventDefault();
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'r') {
                // Ctrl+R : refresh
                loadGithubExplorer();
                e.preventDefault();
            }
        });

        // --- Historique pour Annuler/R√©tablir (Ctrl+Z/Ctrl+Y) ---
        let undoStack = [];
        let redoStack = [];

        function pushUndoState() {
            // Stocke l'√©tat courant pour annuler (chemin, s√©lection, arborescence)
            undoStack.push({
                currentPath: state.currentPath,
                selectedItems: new Set(state.selectedItems),
                githubTree: JSON.parse(JSON.stringify(githubTree))
            });
            // Limite la taille de l'historique
            if (undoStack.length > 50) undoStack.shift();
            redoStack = [];
        }

        function restoreState(snap) {
            if (!snap) return;
            state.currentPath = snap.currentPath;
            state.selectedItems = new Set(snap.selectedItems);
            githubTree = JSON.parse(JSON.stringify(snap.githubTree));
            githubTreeReady = true;
            renderFiles();
            renderBreadcrumb();
            renderFolderTree();
            updateStatusBar();
        }

        function undo() {
            if (undoStack.length === 0) return;
            const snap = undoStack.pop();
            redoStack.push({
                currentPath: state.currentPath,
                selectedItems: new Set(state.selectedItems),
                githubTree: JSON.parse(JSON.stringify(githubTree))
            });
            restoreState(snap);
        }

        function redo() {
            if (redoStack.length === 0) return;
            const snap = redoStack.pop();
            pushUndoState();
            restoreState(snap);
        }

        // Navigation historique
        document.getElementById('nav-back').onclick = () => {
            if (state.historyIndex > 0) {
                state.historyIndex--;
                state.currentPath = state.history[state.historyIndex];
                state.selectedItems.clear();
                renderFiles();
                renderBreadcrumb();
                updateStatusBar();
            }
        };
        document.getElementById('nav-forward').onclick = () => {
            if (state.historyIndex < state.history.length - 1) {
                state.historyIndex++;
                state.currentPath = state.history[state.historyIndex];
                state.selectedItems.clear();
                renderFiles();
                renderBreadcrumb();
                updateStatusBar();
            }
        };
        document.getElementById('nav-up').onclick = () => {
            const parent = state.currentPath.split('/').slice(0, -1).join('/') || '/';
            if (parent !== state.currentPath) goToPath(parent);
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            loadGithubExplorer();
            // Ajout bouton "Nouveau fichier"
            const btnUpload = document.getElementById('btn-upload');
            if (btnUpload) {
                const btnNewFile = document.createElement('button');
                btnNewFile.textContent = "Nouveau fichier";
                btnNewFile.className = "toolbar-button";
                btnNewFile.style.marginLeft = "8px";
                btnNewFile.onclick = startNewFile;
                btnUpload.parentNode.appendChild(btnNewFile);
            }
            document.querySelector('.tab:nth-child(2)').onclick = () => {
                if (state.selectedItems.size === 0) {
                    alert("S√©lectionnez un fichier ou dossier √† partager.");
                    return;
                }
                const path = Array.from(state.selectedItems)[0];
                const url = window.location.origin + window.location.pathname + '?path=' + encodeURIComponent(path);
                navigator.clipboard.writeText(url);
                alert("Lien copi√© dans le presse-papiers !");
            };
            document.querySelector('.tab:nth-child(3)').onclick = () => {
                document.getElementById('btn-view-toggle').click();
            };
        });

        // --- Toolbar boutons : Undo/Redo fonctionnels ---
        document.getElementById('btn-undo').onclick = () => { undo(); };
        document.getElementById('btn-redo').onclick = () => { redo(); };
        document.getElementById('btn-refresh').onclick = () => { loadGithubExplorer(); };

        // --- Toolbar boutons : Couper/Copier/Coller fichiers ET dossiers ---
        let clipboardItems = [];
        let clipboardAction = null;
        document.getElementById('btn-copy').onclick = () => {
            clipboardItems = Array.from(state.selectedItems);
            clipboardAction = 'copy';
        };
        document.getElementById('btn-cut').onclick = () => {
            clipboardItems = Array.from(state.selectedItems);
            clipboardAction = 'cut';
        };
        document.getElementById('btn-paste').onclick = async () => {
            if (!clipboardItems.length) return;
            for (const path of clipboardItems) {
                const parentPath = path.substring(0, path.lastIndexOf('/')) || '/';
                const items = getItemsAtPath(parentPath);
                const item = items.find(i => i.path === path);
                if (!item) continue;
                let destPath = state.currentPath + (state.currentPath.endsWith('/') ? '' : '/') + item.name;
                if (clipboardAction === 'copy') {
                    if (item.type === 'file') {
                        const resp = await fetch(getRawUrl(item.path));
                        const blob = await resp.blob();
                        const reader = new FileReader();
                        reader.onload = async function(ev) {
                            await uploadFileOnGithub(destPath, arrayBufferToBase64(ev.target.result));
                            loadGithubExplorer();
                        };
                        reader.readAsArrayBuffer(blob);
                    } else if (item.type === 'directory') {
                        await copyDirectoryRecursive(item.path, destPath);
                        await loadGithubExplorer();
                    }
                } else if (clipboardAction === 'cut') {
                    await moveFileOrFolder(item.path, state.currentPath);
                }
            }
            clipboardItems = [];
            clipboardAction = null;
        };

        // --- Copie r√©cursive de dossiers ---
        async function copyDirectoryRecursive(srcDir, destDir) {
            const items = getItemsAtPath(srcDir);
            for (const item of items) {
                if (item.type === 'file') {
                    const resp = await fetch(getRawUrl(item.path));
                    const blob = await resp.blob();
                    const reader = new FileReader();
                    await new Promise(resolve => {
                        reader.onload = async function(ev) {
                            await uploadFileOnGithub(destDir + '/' + item.name, arrayBufferToBase64(ev.target.result));
                            resolve();
                        };
                        reader.readAsArrayBuffer(blob);
                    });
                } else if (item.type === 'directory') {
                    await copyDirectoryRecursive(item.path, destDir + '/' + item.name);
                }
            }
        }

        // --- Toolbar boutons : Renommer, Supprimer, Nouveau dossier ---
        document.getElementById('btn-rename').onclick = () => {
            if (state.selectedItems.size === 1) startRename(Array.from(state.selectedItems)[0]);
        };
        document.getElementById('btn-delete').onclick = () => {
            for (const path of state.selectedItems) startDelete(path);
        };
        document.getElementById('btn-new-folder').onclick = () => {
            startNewFolder(state.currentPath);
        };

        // --- Ouvre dynamiquement l'arborescence jusqu'au dossier courant ---
        function openTreeToCurrentPath() {
            const parts = state.currentPath.split('/').filter(Boolean);
            let path = '';
            for (let i = 0; i < parts.length; i++) {
                path += '/' + parts[i];
                const toggle = document.querySelector(`.tree-item[data-path="${path}"] .tree-toggle`);
                if (toggle) {
                    const childrenDiv = document.getElementById('tree-children-' + btoa(path));
                    if (childrenDiv && childrenDiv.innerHTML === '') {
                        // Charger enfants si pas d√©j√† fait
                        const node = getNodeByPath(githubTree, path.split('/').filter(Boolean));
                        childrenDiv.innerHTML = renderFolderTreeChildren(node, path, path.split('/').length);
                    }
                    childrenDiv.style.display = 'block';
                    toggle.textContent = '‚ñº';
                }
            }
            // Ouvre aussi le chemin jusqu'au fichier s√©lectionn√© si un fichier est ouvert
            if (state.selectedItems && state.selectedItems.size === 1) {
                const filePath = Array.from(state.selectedItems)[0];
                const fileParts = filePath.split('/').filter(Boolean);
                let filePathSoFar = '';
                for (let i = 0; i < fileParts.length - 1; i++) {
                    filePathSoFar += '/' + fileParts[i];
                    const toggle = document.querySelector(`.tree-item[data-path="${filePathSoFar}"] .tree-toggle`);
                    if (toggle) {
                        const childrenDiv = document.getElementById('tree-children-' + btoa(filePathSoFar));
                        if (childrenDiv && childrenDiv.innerHTML === '') {
                            const node = getNodeByPath(githubTree, filePathSoFar.split('/').filter(Boolean));
                            childrenDiv.innerHTML = renderFolderTreeChildren(node, filePathSoFar, filePathSoFar.split('/').length);
                        }
                        childrenDiv.style.display = 'block';
                        toggle.textContent = '‚ñº';
                    }
                }
            }
        }

        // --- Affichage dynamique du panneau de d√©tails dans la sidebar ---
        function updateSidebarDetailsPanel() {
            const panel = document.getElementById('sidebar-details-panel');
            if (!state.selectedItems || state.selectedItems.size !== 1) {
                panel.style.display = 'none';
                panel.innerHTML = '';
                return;
            }
            const path = Array.from(state.selectedItems)[0];
            let item = null;
            // Cherche dans le dossier courant et ses enfants
            const allItems = getItemsAtPath(state.currentPath).concat(getItemsAtPath('/'));
            item = allItems.find(i => i.path === path) || null;
            if (!item) {
                // Recherche profonde
                function findDeep(node, path) {
                    for (const key in node) {
                        const val = node[key];
                        if (val && val.__file && val.path === path) return {type:'file', name:key, path:val.path, size:val.size, sha:val.sha};
                        if (val && !val.__file) {
                            const found = findDeep(val, path);
                            if (found) return found;
                        }
                    }
                    return null;
                }
                item = findDeep(githubTree, path);
            }
            if (!item) {
                panel.style.display = 'none';
                panel.innerHTML = '';
                return;
            }
            let html = `<b>Nom :</b> ${item.name}<br>`;
            html += `<b>Type :</b> ${item.type}<br>`;
            if (item.size !== undefined) html += `<b>Taille :</b> ${formatSize(item.size)}<br>`;
            html += `<b>Chemin :</b> <span style="font-size:10px;">${item.path}</span><br>`;
            if (item.type === 'directory') {
                const items = getItemsAtPath(item.path);
                const nbFiles = items.filter(i => i.type === 'file').length;
                const nbDirs = items.filter(i => i.type === 'directory').length;
                html += `<b>Contenu :</b> ${nbFiles} fichier(s), ${nbDirs} dossier(s)<br>`;
            }
            panel.innerHTML = html;
            panel.style.display = '';
        }

        // --- S√©lection souris rectangle (type Windows) ---
        let selectionBox = null;
        let selectionStart = null;
        document.getElementById('files-container').addEventListener('mousedown', function(e) {
            if (e.button !== 0) return;
            if (e.target !== this) return;
            selectionStart = {x: e.pageX, y: e.pageY};
            selectionBox = document.createElement('div');
            selectionBox.style.position = 'absolute';
            selectionBox.style.border = '1px dashed #3498db';
            selectionBox.style.background = 'rgba(52,152,219,0.1)';
            selectionBox.style.left = e.pageX + 'px';
            selectionBox.style.top = e.pageY + 'px';
            selectionBox.style.zIndex = 2000;
            document.body.appendChild(selectionBox);

            function onMouseMove(ev) {
                const x1 = Math.min(selectionStart.x, ev.pageX);
                const y1 = Math.min(selectionStart.y, ev.pageY);
                const x2 = Math.max(selectionStart.x, ev.pageX);
                const y2 = Math.max(selectionStart.y, ev.pageY);
                selectionBox.style.left = x1 + 'px';
                selectionBox.style.top = y1 + 'px';
                selectionBox.style.width = (x2 - x1) + 'px';
                selectionBox.style.height = (y2 - y1) + 'px';

                // S√©lectionne les √©l√©ments dans la box
                document.querySelectorAll('.file-item, .list-item').forEach(el => {
                    const rect = el.getBoundingClientRect();
                    const selRect = selectionBox.getBoundingClientRect();
                    if (rect.left < selRect.right && rect.right > selRect.left &&
                        rect.top < selRect.bottom && rect.bottom > selRect.top) {
                        state.selectedItems.add(el.dataset.path);
                    } else if (!e.ctrlKey && !e.metaKey) {
                        state.selectedItems.delete(el.dataset.path);
                    }
                });
                renderFiles();
                updateStatusBar();
                updateSidebarDetailsPanel();
            }
            function onMouseUp(ev) {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                if (selectionBox) selectionBox.remove();
                selectionBox = null;
                selectionStart = null;
            }
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });
        
        // Nouvelle fonction pour convertir un ArrayBuffer en base64
        function arrayBufferToBase64(buffer) {
            let binary = '';
            const bytes = new Uint8Array(buffer);
            const len = bytes.byteLength;
            for (let i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }

        // Fonction pour cr√©er un nouveau dossier (cr√©e un fichier .gitkeep dans le dossier)
        function startNewFolder(currentPath) {
            const folderName = prompt("Entrez le nom du nouveau dossier :");
            if (!folderName) return;
            const newFolderPath = currentPath + (currentPath.endsWith('/') ? '' : '/') + folderName;
            const gitkeepPath = newFolderPath + '/.gitkeep';
            uploadFileOnGithub(gitkeepPath, btoa("")).then(ok => {
                if (ok) {
                    alert("Dossier cr√©√© !");
                    loadGithubExplorer();
                } else {
                    alert("Erreur lors de la cr√©ation du dossier.");
                }
            });
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Troupe Saint Elme</title>
    <link rel="stylesheet" href="https://javabatchcss.github.io/Troupe-Saint-Elme/style.css">
    <link rel="icon" href="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png">
    <script src="https://javabatchcss.github.io/Troupe-Saint-Elme/mobile-menu.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            // Remplacez "YOUR_USER_ID" par votre ID utilisateur EmailJS
            emailjs.init("pXqUmmdrOccofygDq");
        })();
    </script>
    <style>
        /* Styles spécifiques à la page de contact */
        .contact-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
        }
        .contact-container h1 {
            color: #3498db;
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
        }
        .contact-intro {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1em;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        .checkbox-group {
            margin-top: 10px;
            margin-left: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .checkbox-container input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        .radio-group {
            margin-top: 10px;
            margin-left: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .radio-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .radio-container input[type="radio"] {
            width: auto;
            margin-right: 10px;
        }
        .radio-container label,
        .checkbox-container label {
            font-weight: 400;
            font-size: 1em;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        .form-col {
            flex: 1 0 300px;
            padding: 0 10px;
            margin-bottom: 20px;
        }
        .optional-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        .optional-title {
            color: #3498db;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        .btn-contact {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            margin: 30px auto 0;
            display: block;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-contact:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .form-status {
            margin-top: 15px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .contact-container {
                margin: 20px;
                padding: 20px;
            }
            .form-row {
                flex-direction: column;
            }
            .form-col {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <img style="right:20px" src="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png" alt="Emblème Troupe Saint Elme">
        <img style="left:20px" src="https://javabatchcss.github.io/Troupe-Saint-Elme/images/logo fédération.png" alt="Logo Fédération">
        <h1>Troupe Saint Elme</h1>
        <button class="mobile-menu-button" onclick="toggleMobileMenu()">
            <span class="menu-icon">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </span>
        </button>
        <nav class="mobile-nav">
           <ul>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/index.html">Accueil</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2023.html">2023</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2024.html">2024</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2025.html">2025</a></li>
                <li style="width: 20px;"></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/about-us.html">À Propos</a></li>
               <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/forum.html">Forum</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/contact-us.html" class="active">Contact</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/documentation.html">Documentation</a></li>
                <li><a href="https://www.fsggb.fr/">Site de la Fédération</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="contact-container">
            <h1>Contactez-nous</h1>
            <p class="contact-intro">Vous avez une question ou souhaitez nous rejoindre ? N'hésitez pas à nous contacter en remplissant le formulaire ci-dessous.</p>
            <form id="contactForm">
                <!-- Champs obligatoires -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="nom">Nom *</label>
                            <input type="text" id="nom" name="Nom" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="prenom">Prénom *</label>
                            <input type="text" id="prenom" name="Prénom" required>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="email">Adresse Email *</label>
                            <input type="email" id="email" name="Email" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="telephone">Téléphone *</label>
                            <input type="tel" id="telephone" name="Téléphone" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="adresse">Adresse *</label>
                    <input type="text" id="adresse" name="Adresse" required>
                </div>
                <div class="form-group">
                    <label for="message">Message *</label>
                    <textarea id="message" name="Message" required></textarea>
                </div>
                <!-- Champs facultatifs -->
                <div class="optional-section">
                    <h3 class="optional-title">Informations complémentaires</h3>
                    <div class="form-group">
                        <label>Votre profil:</label>
                        <div class="radio-group">
                            <div class="radio-container">
                                <input type="radio" id="is-scout" name="profile_type" value="scout">
                                <label for="is-scout">Je suis scout</label>
                            </div>
                            <div class="radio-container">
                                <input type="radio" id="is-chef" name="profile_type" value="chef">
                                <label for="is-chef">Je suis chef</label>
                            </div>
                            <div class="radio-container">
                                <input type="radio" id="is-visitor" name="profile_type" value="visitor">
                                <label for="is-visitor">Je suis un simple visiteur</label>
                            </div>
                        </div>
                    </div>
                    <!-- Section Scout Actuel -->
                    <div id="scout-section" style="display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Êtes-vous actuellement scout ? *</label>
                                    <div class="radio-group">
                                        <div class="radio-container">
                                            <input type="radio" id="is-active-scout" name="is_active_scout" value="yes" required tabindex="0">
                                            <label for="is-active-scout">Oui</label>
                                        </div>
                                        <div class="radio-container">
                                            <input type="radio" id="not-active-scout" name="is_active_scout" value="no" tabindex="0">
                                            <label for="not-active-scout">Non</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group" id="saint-elme-appartenance-group" style="display:none;">
                                    <label id="saint-elme-appartenance-label" for="saint-elme-appartenance">Appartenez-vous à la troupe Saint Elme ? *</label>
                                    <div class="radio-group">
                                        <div class="radio-container">
                                            <input type="radio" id="saint-elme-oui" name="saint_elme_appartenance" value="oui">
                                            <label for="saint-elme-oui">Oui</label>
                                        </div>
                                        <div class="radio-container">
                                            <input type="radio" id="saint-elme-non" name="saint_elme_appartenance" value="non">
                                            <label for="saint-elme-non">Non</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="autre-troupe-group" style="display:none;">
                            <label id="autre-troupe-label" for="scout_troupe">À quelle troupe es-tu ?</label>
                            <input type="text" id="scout_troupe" name="scout_troupe">
                        </div>
                        <!-- Patrouille et position : affiché seulement si scout actif -->
                        <div id="patrouille-position-row" class="form-row" style="display:none;">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="patrouille">Patrouille</label>
                                    <select id="patrouille" name="patrouille" onchange="toggleAutrePatrouille()">
                                        <option value="">---    Sélectionner    ---</option>
                                        <option value="cerf">Cerf</option>
                                        <option value="loup">Loup</option>
                                        <option value="isard">Isard</option>
                                        <option value="lynx">Lynx</option>
                                        <option value="levrier">Lévrier</option>
                                        <option value="milan">Milan</option>
                                        <option value="pygarge">Pygargue</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                    <input type="text" id="autre_patrouille" name="autre_patrouille" placeholder="Nom de la patrouille" style="display:none; margin-top:10px;">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="position">Position dans la patrouille</label>
                                    <select id="position" name="position">
                                        <option value="">---    Sélectionner    ---</option>
                                        <option value="cp">Chef de Patrouille (CP)</option>
                                        <option value="sp">Second de Patrouille</option>
                                        <option value="3">3ème</option>
                                        <option value="4">4ème</option>
                                        <option value="5">5ème</option>
                                        <option value="6">6ème</option>
                                        <option value="7">7ème</option>
                                        <option value="8">8ème</option>
                                        <option value="9">9ème</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="scout_start_date">Date d'entrée au scoutisme: *</label>
                            <input type="number" id="scout_start_date" name="scout_start_date" min="1950" max="2024" required tabindex="0">
                            <span id="duree_scout"></span>
                        </div>
                        <!-- Section Progression et Badges -->
                        <div class="form-row">
                            <div class="form-col">
                                <!-- Section Progression -->
                                <div class="form-group">
                                    <label>Progression:</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="promesse" name="progression[]" value="promesse" onchange="updateProgression('promesse')">
                                            <label for="promesse">Promesse</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="seconde" name="progression[]" value="seconde" onchange="updateProgression('seconde')">
                                            <label for="seconde">Seconde Classe</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="premiere" name="progression[]" value="premiere" onchange="updateProgression('premiere')">
                                            <label for="premiere">Première Classe</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="chevalier" name="progression[]" value="chevalier" onchange="updateProgression('chevalier')">
                                            <label for="chevalier">Chevalier de France</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-col">
                                <!-- Section Badges -->
                                <div class="form-group">
                                    <label>Badges et Brevets:</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_liturgiste" name="badges[]" value="liturgiste">
                                            <label for="badge_liturgiste">Liturgiste</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_messager" name="badges[]" value="messager">
                                            <label for="badge_messager">Messager</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_intendant" name="badges[]" value="intendant">
                                            <label for="badge_intendant">Intendant</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_cuisinier" name="badges[]" value="cuisinier">
                                            <label for="badge_cuisinier">Cuisinier</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_meneur" name="badges[]" value="meneur de jeu">
                                            <label for="badge_meneur">Boute-en-train</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_topo" name="badges[]" value="topographiste">
                                            <label for="badge_topo">Topographe</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_matelot" name="badges[]" value="matelotage">
                                            <label for="badge_matelot">Gabier</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_pionnier" name="badges[]" value="pionnérisme">
                                            <label for="badge_pionnier">Pionnier</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_campeur" name="badges[]" value="campeur">
                                            <label for="badge_campeur">Campeur</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_raider" name="badges[]" value="raider">
                                            <label for="badge_raider">Raider</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_secouriste" name="badges[]" value="secouriste">
                                            <label for="badge_secouriste">Secouriste</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="not-active-scout-details" style="display: none;">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="scout_end_date">Date de départ du scoutisme:</label>
                                        <input type="number" id="scout_end_date" name="scout_end_date" min="1950">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Section Ancien Scout avec dates côte à côte -->
                    <div id="ancien-scout-section" style="display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="ancien_start_date">Date d'entrée au scoutisme:</label>
                                    <input type="number" id="ancien_start_date" name="ancien_start_date" min="1950" max="2024">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="ancien_end_date">Date de départ:</label>
                                    <input type="number" id="ancien_end_date" name="ancien_end_date" min="1950" max="2024">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ancien_troupe">À quelle troupe étais-tu ?</label>
                            <input type="text" id="ancien_troupe" name="ancien_troupe">
                        </div>
                        <span id="duree_ancien_scout"></span>
                    </div>
                    <!-- Section Chef -->
                    <div id="chef-section" style="display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="chef_scout_start_date">Date d'entrée au scoutisme:</label>
                                    <input type="number" id="chef_scout_start_date" name="chef_scout_start_date" min="1950">
                                    <span id="duree_scout_chef"></span>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="chef_start_date">Date de début en tant que chef:</label>
                                    <input type="number" id="chef_start_date" name="chef_start_date" min="1950">
                                    <span id="duree_chef"></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Formation BAFA:</label>
                            <div class="checkbox-group">
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_base" name="bafa[]" value="Formation générale (Base)">
                                    <label for="bafa_base">Formation générale (Base)</label>
                                </div>
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_pratique" name="bafa[]" value="Stage pratique">
                                    <label for="bafa_pratique">Stage pratique</label>
                                </div>
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_appro" name="bafa[]" value="Approfondissement">
                                    <label for="bafa_appro">Approfondissement</label>
                                </div>
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_complet" name="bafa[]" value="BAFA Complet">
                                    <label for="bafa_complet">BAFA Complet</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Rôle actuel: *</label>
                            <select id="chef_role" name="chef_role" required tabindex="0">
                                <option value="">-- Sélectionner --</option>
                                <option value="ct">Chef de Troupe</option>
                                <option value="acte">Assistant Chef de Troupe</option>
                                <option value="aumonier">Aumônier</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn-contact">Envoyer</button>
            </form>
            <div id="formStatus" class="form-status"></div>
        </div>
    </main>
    <footer>
        <p>&copy; Troupe Saint Elme</p>
    </footer>
    <script>
        // === FONCTIONS UTILITAIRES ===
        const utils = {
            translateValue: function(name, value) {
                const translations = {
                    profile_type: {
                        scout: 'Scout',
                        chef: 'Chef scout',
                        visitor: 'Simple visiteur'
                    },
                    is_active_scout: {
                        yes: 'Oui',
                        no: 'Non'
                    },
                    saint_elme_appartenance: {
                        oui: 'Oui',
                        non: 'Non'
                    },
                    position: {
                        cp: 'Chef de Patrouille',
                        sp: 'Second de Patrouille',
                        3: 'Troisième',
                        4: 'Quatrième',
                        5: 'Cinquième',
                        6: 'Sixième',
                        7: 'Septième',
                        8: 'Huitième',
                        9: 'Neuvième'
                    },
                    chef_role: {
                        ct: 'Chef de Troupe',
                        acte: 'Assistant Chef de Troupe',
                        aumonier: 'Aumônier'
                    },
                    patrouille: {
                        cerf: 'Patrouille du Cerf',
                        loup: 'Patrouille du Loup',
                        isard: 'Patrouille de l\'Isard',
                        lynx: 'Patrouille du Lynx',
                        levrier: 'Patrouille du Lévrier',
                        milan: 'Patrouille du Milan',
                        pygarge: 'Patrouille du Pygargue',
                        autre: 'Autre patrouille'
                    }
                };
                return translations[name]?.[value] || value;
            },
            
            getRadioValue: function(name, form) {
                const checked = form.querySelector(`input[name="${name}"]:checked`);
                return checked ? checked.value : '';
            },
            
            getCheckedValues: function(name, form) {
                return Array.from(form.querySelectorAll(`input[name="${name}[]"]:checked`))
                    .map(cb => cb.value)
                    .join(', ');
            }
        };

        // === FONCTIONS DE NAVIGATION ===
        function toggleMobileMenu() {
            const mobileButton = document.querySelector('.mobile-menu-button');
            const mobileNav = document.querySelector('.mobile-nav');
            mobileButton.classList.toggle('active');
            mobileNav.classList.toggle('mobile-nav-active');
        }

        // === FONCTIONS DE PROGRESSION SCOUTE ===
        function updateProgression(level) {
            const progressionOrder = ['promesse', 'seconde', 'premiere', 'chevalier'];
            const levelIndex = progressionOrder.indexOf(level);
            const isChecked = document.getElementById(level).checked;
            
            if (isChecked) {
                // Cocher tous les niveaux inférieurs
                for (let i = 0; i <= levelIndex; i++) {
                    document.getElementById(progressionOrder[i]).checked = true;
                }
            } else {
                // Décocher tous les niveaux supérieurs
                for (let i = levelIndex; i < progressionOrder.length; i++) {
                    document.getElementById(progressionOrder[i]).checked = false;
                }
            }
        }

        function toggleAutrePatrouille() {
            const patrouilleSelect = document.getElementById('patrouille');
            const autrePatrouille = document.getElementById('autre_patrouille');
            
            if (patrouilleSelect.value === 'autre') {
                autrePatrouille.style.display = 'block';
                autrePatrouille.required = true;
            } else {
                autrePatrouille.style.display = 'none';
                autrePatrouille.required = false;
                autrePatrouille.value = '';
            }
        }

        // === GESTION DYNAMIQUE DU FORMULAIRE ===
        function clearSectionRequirements(section) {
            if (!section) return;
            section.querySelectorAll('[required]').forEach(el => {
                el.required = false;
                if (el.type === 'radio' || el.type === 'checkbox') {
                    el.checked = false;
                } else {
                    el.value = '';
                }
            });
        }

        function updateFormFields() {
            const profileType = document.querySelector('input[name="profile_type"]:checked')?.value;
            const sections = {
                scout: document.getElementById('scout-section'),
                chef: document.getElementById('chef-section')
            };

            // Masquer toutes les sections et nettoyer
            Object.values(sections).forEach(section => {
                if (section) {
                    section.style.display = 'none';
                    clearSectionRequirements(section);
                }
            });
            
            // Masquer aussi la section ancien scout (qui était incorrectement assignée aux visiteurs)
            const ancienScoutSection = document.getElementById('ancien-scout-section');
            if (ancienScoutSection) {
                ancienScoutSection.style.display = 'none';
                clearSectionRequirements(ancienScoutSection);
            }

            // Afficher la section appropriée SEULEMENT pour scout et chef
            if (profileType === 'scout' && sections.scout) {
                sections.scout.style.display = 'block';
                setupScoutSection();
            } else if (profileType === 'chef' && sections.chef) {
                sections.chef.style.display = 'block';
            }
            // Pour 'visitor' : ne rien afficher (comportement par défaut)
        }

        function setupScoutSection() {
            const saintElmeGroup = document.getElementById('saint-elme-appartenance-group');
            const autreTroupeGroup = document.getElementById('autre-troupe-group');
            const patrouilleRow = document.getElementById('patrouille-position-row');
            const notActiveDetails = document.getElementById('not-active-scout-details');

            // Afficher le groupe d'appartenance à Saint Elme
            saintElmeGroup.style.display = 'block';

            // Écouteurs pour scout actif/inactif
            const activeScoutRadios = document.querySelectorAll('input[name="is_active_scout"]');
            activeScoutRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const isActive = this.value === 'yes';
                    
                    // Mettre à jour le label
                    document.getElementById('saint-elme-appartenance-label').textContent = 
                        isActive ? "Appartiens-tu à la troupe Saint Elme ?" : 
                                  "Avez-vous appartenu à la troupe Saint Elme ?";

                    // Gérer l'affichage des sections
                    if (isActive) {
                        notActiveDetails.style.display = 'none';
                        patrouilleRow.style.display = 'flex';
                    } else {
                        notActiveDetails.style.display = 'block';
                        patrouilleRow.style.display = 'none';
                    }
                    
                    setupTroupeSelection(isActive);
                });
            });

            // Masquer par défaut
            autreTroupeGroup.style.display = 'none';
        }

        function setupTroupeSelection(isActiveScout) {
            const autreTroupeGroup = document.getElementById('autre-troupe-group');
            const scoutTroupe = document.getElementById('scout_troupe');

            document.querySelectorAll('input[name="saint_elme_appartenance"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'non') {
                        autreTroupeGroup.style.display = 'block';
                        scoutTroupe.required = true;
                        scoutTroupe.placeholder = isActiveScout ? 
                            "Nom de ta troupe actuelle" : 
                            "Nom de ton ancienne troupe";
                    } else {
                        autreTroupeGroup.style.display = 'none';
                        scoutTroupe.required = false;
                        scoutTroupe.value = '';
                    }
                });
            });
        }

        // === CALCULS DE DURÉE ===
        function calculerDureeScout() {
            const dateDebut = parseInt(document.getElementById('scout_start_date').value);
            const spanDuree = document.getElementById('duree_scout');
            
            if (!dateDebut) {
                spanDuree.textContent = '';
                return;
            }
            
            const duree = new Date().getFullYear() - dateDebut;
            spanDuree.textContent = ` (${duree} an${duree > 1 ? 's' : ''} de scoutisme)`;
        }

        function calculerDureeChef() {
            const dateDebutScout = parseInt(document.getElementById('chef_scout_start_date').value);
            const dateDebutChef = parseInt(document.getElementById('chef_start_date').value);
            const spanDureeScout = document.getElementById('duree_scout_chef');
            const spanDureeChef = document.getElementById('duree_chef');
            const anneeActuelle = new Date().getFullYear();

            if (dateDebutScout) {
                const dureeScout = anneeActuelle - dateDebutScout;
                spanDureeScout.textContent = ` (${dureeScout} an${dureeScout > 1 ? 's' : ''} de scoutisme)`;
            } else {
                spanDureeScout.textContent = '';
            }

            if (dateDebutChef) {
                const dureeChef = anneeActuelle - dateDebutChef;
                spanDureeChef.textContent = ` (${dureeChef} an${dureeChef > 1 ? 's' : ''} en tant que chef)`;
            } else {
                spanDureeChef.textContent = '';
            }
        }

        function calculerDureeAncienScout() {
            const dateDebut = parseInt(document.getElementById('ancien_start_date').value);
            const dateFin = parseInt(document.getElementById('ancien_end_date').value);
            const spanDuree = document.getElementById('duree_ancien_scout');
            
            if (!dateDebut || !dateFin) {
                spanDuree.textContent = '';
                return;
            }
            
            const duree = dateFin - dateDebut;
            spanDuree.textContent = ` (${duree} an${duree > 1 ? 's' : ''} de scoutisme)`;
        }

        // === CONSTRUCTION DES EMAILS ===
        function buildEmailContent(form) {
            const profileType = utils.getRadioValue('profile_type', form);
            const currentDate = new Date().toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let emailContent = `
<table width="100%" cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, sans-serif; background-color: #f8f9fa;">
    <tr>
        <td>
            <table width="100%" max-width="800px" cellpadding="0" cellspacing="0" border="0" style="margin: 0 auto;">
                <tr>
                    <td style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 30px; text-align: center;">
                        <h1 style="margin: 0; font-size: 32px; font-weight: bold;">🏕️ NOUVEAU CONTACT</h1>
                        <h2 style="margin: 10px 0 0 0; font-size: 22px; font-weight: normal;">Troupe Saint Elme</h2>
                        <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">${currentDate}</p>
                    </td>
                </tr>
                
                <tr>
                    <td style="padding: 30px; background-color: white;">
                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #e8f4fd; padding: 25px; margin-bottom: 25px; border-left: 5px solid #3498db; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 20px; font-weight: bold;">📋 Informations de contact</h3>
                                    <table width="100%" cellpadding="8" cellspacing="0" border="0">
                                        <tr>
                                            <td style="font-weight: bold; color: #2c3e50; width: 150px; vertical-align: top;">👤 Nom complet :</td>
                                            <td style="color: #34495e; font-size: 16px;">${form.prenom.value} ${form.nom.value}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold; color: #2c3e50; vertical-align: top;">📧 Email :</td>
                                            <td><a href="mailto:${form.email.value}" style="color: #3498db; text-decoration: none; font-size: 16px; font-weight: bold;">${form.email.value}</a></td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold; color: #2c3e50; vertical-align: top;">📞 Téléphone :</td>
                                            <td><a href="tel:${form.telephone.value}" style="color: #27ae60; text-decoration: none; font-size: 16px; font-weight: bold;">${form.telephone.value}</a></td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold; color: #2c3e50; vertical-align: top;">📍 Adresse :</td>
                                            <td style="color: #34495e; font-size: 16px;">${form.adresse.value}</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #fff3cd; padding: 25px; margin-bottom: 25px; border-left: 5px solid #ffc107; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 20px 0; color: #856404; font-size: 20px; font-weight: bold;">💬 Message</h3>
                                    <div style="background-color: white; padding: 20px; border-radius: 8px; color: #333; line-height: 1.6; font-size: 16px; border: 1px solid #e9ecef;">
                                        ${form.message.value}
                                    </div>
                                </td>
                            </tr>
                        </table>`;

            // Ajouter les informations de profil
            if (profileType) {
                emailContent += buildProfileSection(form, profileType);
            }

            // Priorité haute pour scouts/chefs
            if (profileType === 'scout' || profileType === 'chef') {
                emailContent += `
                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffebee; padding: 25px; margin-bottom: 25px; border-left: 5px solid #f44336; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 15px 0; color: #c62828; font-size: 20px; font-weight: bold;">🚨 PRIORITÉ HAUTE</h3>
                                    <p style="margin: 0; color: #c62828; font-weight: bold; font-size: 16px;">Contact scout/chef - Traitement prioritaire recommandé</p>
                                </td>
                            </tr>
                        </table>`;
            }

            // Actions recommandées
            emailContent += `
                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #e8f5e8; padding: 25px; margin-bottom: 25px; border-left: 5px solid #4caf50; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 20px 0; color: #2e7d32; font-size: 20px; font-weight: bold;">⚡ Actions recommandées</h3>
                                    <ul style="margin: 0; padding-left: 25px; color: #2e7d32; font-size: 16px; line-height: 1.6;">
                                        <li style="margin-bottom: 10px;"><strong>🔄 Répondre dans les 24h</strong></li>
                                        <li style="margin-bottom: 10px;">📧 Répondre à : <a href="mailto:${form.email.value}" style="color: #3498db; text-decoration: none; font-weight: bold;">${form.email.value}</a></li>
                                        <li style="margin-bottom: 10px;">📞 Appeler au : <a href="tel:${form.telephone.value}" style="color: #27ae60; text-decoration: none; font-weight: bold;">${form.telephone.value}</a></li>
                                    </ul>
                                </td>
                            </tr>
                        </table>

                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-top: 1px solid #e9ecef; padding-top: 20px;">
                            <tr>
                                <td style="text-align: center; color: #6c757d; font-size: 12px; line-height: 1.5;">
                                    📧 Formulaire de contact automatique<br>
                                    🏕️ <strong>Fédération des Scouts et Guides Godefroy de Bouillon</strong><br>
                                    <em>Répondez directement à : <a href="mailto:contact.troupesaintelme@gmail.com">contact.troupesaintelme@gmail.com</a></em>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>`;

            return emailContent;
        }

        function buildProfileSection(form, profileType) {
            let profileContent = `
                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #e3f2fd; padding: 25px; margin-bottom: 25px; border-left: 5px solid #2196f3; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 20px 0; color: #1565c0; font-size: 20px; font-weight: bold;">🔍 Profil détaillé</h3>
                                    <p style="margin: 0 0 15px 0; font-size: 16px;"><strong>Type de profil :</strong> <span style="color: #2196f3; font-weight: bold;">${utils.translateValue('profile_type', profileType)}</span></p>`;

            if (profileType === 'scout') {
                profileContent += buildScoutDetails(form);
            } else if (profileType === 'chef') {
                profileContent += buildChefDetails(form);
            } else if (profileType === 'visitor') {
                profileContent += buildVisitorDetails(form);
            }

            profileContent += `
                                </td>
                            </tr>
                        </table>`;
            
            return profileContent;
        }

        function buildScoutDetails(form) {
            let details = '';
            const isActiveScout = utils.getRadioValue('is_active_scout', form);
            const scoutStartDate = form.scout_start_date?.value;
            const scoutEndDate = form.scout_end_date?.value;
            const appartenance = utils.getRadioValue('saint_elme_appartenance', form);
            const scoutTroupe = form.scout_troupe?.value;
            const patrouille = form.patrouille?.value;
            const autrePatrouille = form.autre_patrouille?.value;
            const position = form.position?.value;
            const progression = utils.getCheckedValues('progression', form);
            const badges = utils.getCheckedValues('badges', form);

            if (isActiveScout) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Scout actuellement actif :</strong> ${utils.translateValue('is_active_scout', isActiveScout)}</p>`;
            }
            
            if (scoutStartDate) {
                const duree = new Date().getFullYear() - scoutStartDate;
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Date d'entrée au scoutisme :</strong> ${scoutStartDate} <em>(${duree} an${duree > 1 ? 's' : ''} d'ancienneté)</em></p>`;
            }
            
            if (scoutEndDate) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Date de départ du scoutisme :</strong> ${scoutEndDate}</p>`;
            }
            
            if (appartenance) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Appartient à la Troupe Saint Elme :</strong> ${utils.translateValue('saint_elme_appartenance', appartenance)}</p>`;
            }
            
            if (scoutTroupe) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Troupe :</strong> ${scoutTroupe}</p>`;
            }
            
            if (patrouille) {
                let patrouilleInfo = utils.translateValue('patrouille', patrouille);
                if (patrouille === 'autre' && autrePatrouille) {
                    patrouilleInfo += ` (${autrePatrouille})`;
                }
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Patrouille :</strong> ${patrouilleInfo}</p>`;
            }
            
            if (position) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Position dans la patrouille :</strong> ${utils.translateValue('position', position)}</p>`;
            }
            
            if (progression) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Progression scoute :</strong> ${progression}</p>`;
            }
            
            if (badges) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Badges et brevets :</strong> ${badges}</p>`;
            }

            return details;
        }

        function buildChefDetails(form) {
            let details = '';
            const chefScoutStartDate = form.chef_scout_start_date?.value;
            const chefStartDate = form.chef_start_date?.value;
            const chefRole = form.chef_role?.value;
            const bafa = utils.getCheckedValues('bafa', form);

            if (chefScoutStartDate) {
                const dureeScout = new Date().getFullYear() - chefScoutStartDate;
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Date d'entrée au scoutisme :</strong> ${chefScoutStartDate} <em>(${dureeScout} an${dureeScout > 1 ? 's' : ''} d'ancienneté)</em></p>`;
            }
            
            if (chefStartDate) {
                const dureeChef = new Date().getFullYear() - chefStartDate;
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Date de début en tant que chef :</strong> ${chefStartDate} <em>(${dureeChef} an${dureeChef > 1 ? 's' : ''} d'expérience)</em></p>`;
            }
            
            if (chefRole) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Rôle actuel :</strong> ${utils.translateValue('chef_role', chefRole)}</p>`;
            }
            
            if (bafa) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Formation BAFA :</strong> ${bafa}</p>`;
            }

            return details;
        }

        function buildVisitorDetails(form) {
            let details = '';
            const ancienStartDate = form.ancien_start_date?.value;
            const ancienEndDate = form.ancien_end_date?.value;
            const ancienTroupe = form.ancien_troupe?.value;

            if (ancienStartDate || ancienEndDate || ancienTroupe) {
                details += `<p style="margin: 8px 0; font-size: 15px;"><strong>Informations d'ancien scout :</strong></p>
                <ul style="margin: 10px 0; padding-left: 25px; font-size: 15px;">`;
                
                if (ancienStartDate) {
                    details += `<li style="margin-bottom: 5px;">Date d'entrée : ${ancienStartDate}</li>`;
                }
                
                if (ancienEndDate) {
                    details += `<li style="margin-bottom: 5px;">Date de départ : ${ancienEndDate}</li>`;
                }
                
                if (ancienStartDate && ancienEndDate) {
                    const duree = ancienEndDate - ancienStartDate;
                    details += `<li style="margin-bottom: 5px;">Durée totale : ${duree} an${duree > 1 ? 's' : ''}</li>`;
                }
                
                if (ancienTroupe) {
                    details += `<li style="margin-bottom: 5px;">Ancienne troupe : ${ancienTroupe}</li>`;
                }
                
                details += `</ul>`;
            }

            return details;
        }

        function buildConfirmationEmail(form) {
            return `
<table width="100%" cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, sans-serif; background-color: #f8f9fa;">
    <tr>
        <td>
            <table width="100%" max-width="600px" cellpadding="0" cellspacing="0" border="0" style="margin: 0 auto;">
                <tr>
                    <td style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 30px; text-align: center;">
                        <h1 style="margin: 0; font-size: 28px; font-weight: bold;">✅ Confirmation reçue</h1>
                        <h2 style="margin: 15px 0 0 0; font-size: 20px; font-weight: normal;">🏕️ Troupe Saint Elme</h2>
                    </td>
                </tr>
                
                <tr>
                    <td style="padding: 30px; background-color: white;">
                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #e8f5e8; padding: 25px; margin-bottom: 25px; border-left: 5px solid #27ae60; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 15px 0; color: #27ae60; font-size: 20px;">Bonjour ${form.prenom.value} ${form.nom.value},</h3>
                                    <p style="margin: 0; color: #2c3e50; line-height: 1.6; font-size: 16px;">Votre message a bien été reçu ! Nous vous remercions pour votre intérêt pour la Troupe Saint Elme.</p>
                                </td>
                            </tr>
                        </table>
                        
                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f8f9fa; padding: 25px; margin-bottom: 25px; border-left: 5px solid #6c757d; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 15px 0; color: #495057; font-size: 18px;">📋 Vos coordonnées</h3>
                                    <p style="margin: 8px 0; font-size: 15px;"><strong>📧 Email :</strong> ${form.email.value}</p>
                                    <p style="margin: 8px 0; font-size: 15px;"><strong>📞 Téléphone :</strong> ${form.telephone.value}</p>
                                </td>
                            </tr>
                        </table>

                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #d1ecf1; padding: 25px; margin-bottom: 25px; border-left: 5px solid #17a2b8; border-radius: 8px;">
                            <tr>
                                <td>
                                    <h3 style="margin: 0 0 15px 0; color: #0c5460; font-size: 18px;">⏱️ Prochaines étapes</h3>
                                    <ul style="margin: 0; padding-left: 25px; color: #0c5460; line-height: 1.6; font-size: 15px;">
                                        <li style="margin-bottom: 8px;">Notre équipe va examiner votre message</li>
                                        <li style="margin-bottom: 8px;">Vous recevrez une réponse dans les plus brefs délais</li>
                                        <li style="margin-bottom: 8px;">Pour toute urgence : <a href="mailto:contact.troupesaintelme@gmail.com" style="color: #3498db; text-decoration: none;">contact.troupesaintelme@gmail.com</a></li>
                                    </ul>
                                </td>
                            </tr>
                        </table>

                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-top: 1px solid #e9ecef; padding-top: 20px;">
                            <tr>
                                <td style="text-align: center; color: #6c757d; font-size: 14px; line-height: 1.5;">
                                    Cordialement,<br>
                                    🏕️ <strong>La Troupe Saint Elme</strong><br>
                                    Groupe Beaudoin IV de Jérusalem<br>
                                    Fédération des Scouts et Guides Godefroy de Bouillon
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>`;
        }

        // === GESTION DE L'ENVOI EMAILJS ===
        function displayMessage(type, title, content) {
            const colors = {
                success: { bg: '#d4edda', color: '#155724', border: '#c3e6cb' },
                error: { bg: '#f8d7da', color: '#721c24', border: '#f5c6cb' }
            };
            
            document.getElementById('formStatus').innerHTML = `
                <div style="background-color: ${colors[type].bg}; color: ${colors[type].color}; padding: 15px; border-radius: 8px; border: 1px solid ${colors[type].border};">
                    <strong>${title}</strong><br>
                    ${content}
                </div>`;
        }

        function handleFormSubmit(event) {
            event.preventDefault();
            
            document.getElementById('formStatus').textContent = 'Envoi en cours...';
            document.getElementById('formStatus').style.color = '#3498db';

            const form = event.target;
            
            // Validation
            if (!form.email.value || !form.nom.value || !form.prenom.value || !form.message.value) {
                displayMessage('error', 'Erreur', 'Veuillez remplir tous les champs obligatoires.');
                return;
            }

            // Email admin - ENVOYÉ À L'ADMINISTRATEUR
            const adminEmail = buildEmailContent(form);
            const adminParams = {
                subject: `🏕️ Nouveau contact - ${form.prenom.value} ${form.nom.value}`,
                name: `${form.prenom.value} ${form.nom.value}`,
                email: "contact.troupesaintelme@gmail.com",
                contenu: adminEmail
            };

            // Envoi séquentiel
            emailjs.send('contact_troupe_st_elme', 'Troupe Saint Elme', adminParams)
                .then(() => {
                    // Email de confirmation - ENVOYÉ AU VISITEUR
                    const confirmationEmail = buildConfirmationEmail(form);
                    const userParams = {
                        subject: `Message reçu - Troupe Saint Elme`,
                        name: "Troupe Saint Elme",
                        email: form.email.value,
                        contenu: confirmationEmail
                    };
                    
                    return emailjs.send('contact_troupe_st_elme', 'Troupe Saint Elme', userParams);
                })
                .then(() => {
                    displayMessage('success', '✅ Succès !', 
                        `📧 Votre message a été envoyé avec succès !<br>
                         📬 Un email de confirmation vous a été envoyé à <strong>${form.email.value}</strong><br>
                         <small style="color: #6c757d;">Pensez à vérifier vos spams si vous ne le trouvez pas.</small>`);
                    
                    form.reset();
                    updateFormFields();
                })
                .catch((error) => {
                    console.error('Erreur EmailJS:', error);
                    
                    const errorMessages = {
                        422: '📧 Problème de configuration EmailJS.',
                        400: '⚠️ Erreur dans les données du formulaire.',
                        401: '🔐 Erreur d\'authentification EmailJS.'
                    };
                    
                    const errorMessage = errorMessages[error.status] || '❌ Une erreur technique est survenue.';
                    
                    displayMessage('error', 'Erreur d\'envoi', 
                        `${errorMessage}<br>
                         <small>Contactez-nous directement à : contact.troupesaintelme@gmail.com</small>`);
                });
        }

        // === INITIALISATION ===
        document.addEventListener('DOMContentLoaded', function() {
            // Écouteurs pour les profils
            document.querySelectorAll('input[name="profile_type"]').forEach(radio => {
                radio.addEventListener('change', updateFormFields);
            });
            
            // Écouteurs pour les calculs de durée
            document.getElementById('scout_start_date')?.addEventListener('input', calculerDureeScout);
            document.getElementById('chef_scout_start_date')?.addEventListener('input', calculerDureeChef);
            document.getElementById('chef_start_date')?.addEventListener('input', calculerDureeChef);
            document.getElementById('ancien_start_date')?.addEventListener('input', calculerDureeAncienScout);
            document.getElementById('ancien_end_date')?.addEventListener('input', calculerDureeAncienScout);
            
            // Envoi du formulaire
            document.getElementById('contactForm').addEventListener('submit', handleFormSubmit);
            
            // Initialisation de l'affichage
            updateFormFields();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Troupe Saint Elme</title>
    <link rel="stylesheet" href="https://javabatchcss.github.io/Troupe-Saint-Elme/style.css">
    <link rel="icon" href="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png">
    <script src="https://javabatchcss.github.io/Troupe-Saint-Elme/mobile-menu.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            // Remplacez "YOUR_USER_ID" par votre ID utilisateur EmailJS
            emailjs.init("SRInaIFjhH3jlvvwF");
        })();
    </script>
    <style>
        /* Styles spécifiques à la page de contact */
        .contact-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
        }
        .contact-container h1 {
            color: #3498db;
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
        }
        .contact-intro {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1em;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        .checkbox-group {
            margin-top: 10px;
            margin-left: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .checkbox-container input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        .radio-group {
            margin-top: 10px;
            margin-left: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .radio-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .radio-container input[type="radio"] {
            width: auto;
            margin-right: 10px;
        }
        .radio-container label,
        .checkbox-container label {
            font-weight: 400;
            font-size: 1em;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        .form-col {
            flex: 1 0 300px;
            padding: 0 10px;
            margin-bottom: 20px;
        }
        .optional-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        .optional-title {
            color: #3498db;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        .btn-contact {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            margin: 30px auto 0;
            display: block;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-contact:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .form-status {
            margin-top: 15px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .contact-container {
                margin: 20px;
                padding: 20px;
            }
            .form-row {
                flex-direction: column;
            }
            .form-col {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <img style="right:20px" src="https://javabatchcss.github.io/Troupe-Saint-Elme/images/embleme troupe.png" alt="Emblème Troupe Saint Elme">
        <img style="left:20px" src="https://javabatchcss.github.io/Troupe-Saint-Elme/images/logo fédération.png" alt="Logo Fédération">
        <h1>Troupe Saint Elme</h1>
        <button class="mobile-menu-button" onclick="toggleMobileMenu()">
            <span class="menu-icon">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </span>
        </button>
        <nav class="mobile-nav">
           <ul>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/index.html">Accueil</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2023.html">2023</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2024.html">2024</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/annee_2025.html">2025</a></li>
                <li style="width: 20px;"></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/about-us.html">À Propos</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/contact-us.html" class="active">Contact</a></li>
                <li><a href="https://javabatchcss.github.io/Troupe-Saint-Elme/documentation.html">Documentation</a></li>
                <li><a href="https://www.fsggb.fr/">Site de la Fédération</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="contact-container">
            <h1>Contactez-nous</h1>
            <p class="contact-intro">Vous avez une question ou souhaitez nous rejoindre ? N'hésitez pas à nous contacter en remplissant le formulaire ci-dessous.</p>
            <form id="contactForm">
                <!-- Champs obligatoires -->
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="nom">Nom *</label>
                            <input type="text" id="nom" name="Nom" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="prenom">Prénom *</label>
                            <input type="text" id="prenom" name="Prénom" required>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="email">Adresse Email *</label>
                            <input type="email" id="email" name="Email" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="telephone">Téléphone *</label>
                            <input type="tel" id="telephone" name="Téléphone" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="adresse">Adresse *</label>
                    <input type="text" id="adresse" name="Adresse" required>
                </div>
                <div class="form-group">
                    <label for="message">Message *</label>
                    <textarea id="message" name="Message" required></textarea>
                </div>
                <!-- Champs facultatifs -->
                <div class="optional-section">
                    <h3 class="optional-title">Informations complémentaires</h3>
                    <div class="form-group">
                        <label>Votre profil: *</label>
                        <div class="radio-group">
                            <div class="radio-container">
                                <input type="radio" id="is-scout" name="profile_type" value="scout" required>
                                <label for="is-scout">Je suis scout</label>
                            </div>
                            <div class="radio-container">
                                <input type="radio" id="is-chef" name="profile_type" value="chef">
                                <label for="is-chef">Je suis chef</label>
                            </div>
                            <div class="radio-container">
                                <input type="radio" id="is-visitor" name="profile_type" value="visitor">
                                <label for="is-visitor">Je suis un simple visiteur</label>
                            </div>
                        </div>
                    </div>
                    <!-- Section Scout Actuel -->
                    <div id="scout-section" style="display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Êtes-vous actuellement scout ? *</label>
                                    <div class="radio-group">
                                        <div class="radio-container">
                                            <input type="radio" id="is-active-scout" name="is_active_scout" value="yes" required>
                                            <label for="is-active-scout">Oui</label>
                                        </div>
                                        <div class="radio-container">
                                            <input type="radio" id="not-active-scout" name="is_active_scout" value="no">
                                            <label for="not-active-scout">Non</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group" id="saint-elme-appartenance-group" style="display:none;">
                                    <label id="saint-elme-appartenance-label" for="saint-elme-appartenance">Appartenez-vous à la troupe Saint Elme ? *</label>
                                    <div class="radio-group">
                                        <div class="radio-container">
                                            <input type="radio" id="saint-elme-oui" name="saint_elme_appartenance" value="oui">
                                            <label for="saint-elme-oui">Oui</label>
                                        </div>
                                        <div class="radio-container">
                                            <input type="radio" id="saint-elme-non" name="saint_elme_appartenance" value="non">
                                            <label for="saint-elme-non">Non</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="autre-troupe-group" style="display:none;">
                            <label id="autre-troupe-label" for="scout_troupe">À quelle troupe es-tu ?</label>
                            <input type="text" id="scout_troupe" name="scout_troupe">
                        </div>
                        <!-- Patrouille et position : affiché seulement si scout actif -->
                        <div id="patrouille-position-row" class="form-row" style="display:none;">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="patrouille">Patrouille</label>
                                    <select id="patrouille" name="patrouille" onchange="toggleAutrePatrouille()">
                                        <option value="">---    Sélectionner    ---</option>
                                        <option value="cerf">Cerf</option>
                                        <option value="loup">Loup</option>
                                        <option value="isard">Isard</option>
                                        <option value="lynx">Lynx</option>
                                        <option value="levrier">Lévrier</option>
                                        <option value="milan">Milan</option>
                                        <option value="pygarge">Pygargue</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                    <input type="text" id="autre_patrouille" name="autre_patrouille" placeholder="Nom de la patrouille" style="display:none; margin-top:10px;">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="position">Position dans la patrouille</label>
                                    <select id="position" name="position">
                                        <option value="">---    Sélectionner    ---</option>
                                        <option value="cp">Chef de Patrouille (CP)</option>
                                        <option value="sp">Second de Patrouille</option>
                                        <option value="3">3ème</option>
                                        <option value="4">4ème</option>
                                        <option value="5">5ème</option>
                                        <option value="6">6ème</option>
                                        <option value="7">7ème</option>
                                        <option value="8">8ème</option>
                                        <option value="9">9ème</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="scout_start_date">Date d'entrée au scoutisme: *</label>
                            <input type="number" id="scout_start_date" name="scout_start_date" min="1950" max="2024" required>
                            <span id="duree_scout"></span>
                        </div>
                        <!-- Section Progression et Badges -->
                        <div class="form-row">
                            <div class="form-col">
                                <!-- Section Progression -->
                                <div class="form-group">
                                    <label>Progression:</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="promesse" name="progression[]" value="promesse" onchange="updateProgression('promesse')">
                                            <label for="promesse">Promesse</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="seconde" name="progression[]" value="seconde" onchange="updateProgression('seconde')">
                                            <label for="seconde">Seconde Classe</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="premiere" name="progression[]" value="premiere" onchange="updateProgression('premiere')">
                                            <label for="premiere">Première Classe</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="chevalier" name="progression[]" value="chevalier" onchange="updateProgression('chevalier')">
                                            <label for="chevalier">Chevalier de France</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-col">
                                <!-- Section Badges -->
                                <div class="form-group">
                                    <label>Badges et Brevets:</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_liturgiste" name="badges[]" value="liturgiste">
                                            <label for="badge_liturgiste">Liturgiste</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_messager" name="badges[]" value="messager">
                                            <label for="badge_messager">Messager</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_intendant" name="badges[]" value="intendant">
                                            <label for="badge_intendant">Intendant</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_cuisinier" name="badges[]" value="cuisinier">
                                            <label for="badge_cuisinier">Cuisinier</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_meneur" name="badges[]" value="meneur">
                                            <label for="badge_meneur">Boute-en-train</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_topo" name="badges[]" value="topo">
                                            <label for="badge_topo">Topographe</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_matelot" name="badges[]" value="matelot">
                                            <label for="badge_matelot">Gabier</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_pionnier" name="badges[]" value="pionnier">
                                            <label for="badge_pionnier">Pionnier</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_campeur" name="badges[]" value="campeur">
                                            <label for="badge_campeur">Campeur</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_raider" name="badges[]" value="raider">
                                            <label for="badge_raider">Raider</label>
                                        </div>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="badge_secouriste" name="badges[]" value="secouriste">
                                            <label for="badge_secouriste">Secouriste</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="not-active-scout-details" style="display: none;">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="scout_end_date">Date de départ du scoutisme: *</label>
                                        <input type="number" id="scout_end_date" name="scout_end_date" min="1950" max="2024" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Section Ancien Scout avec dates côte à côte -->
                    <div id="ancien-scout-section" style="display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="ancien_start_date">Date d'entrée au scoutisme: *</label>
                                    <input type="number" id="ancien_start_date" name="ancien_start_date" min="1950" max="2024" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="ancien_end_date">Date de départ: *</label>
                                    <input type="number" id="ancien_end_date" name="ancien_end_date" min="1950" max="2024" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ancien_troupe">À quelle troupe étais-tu ? *</label>
                            <input type="text" id="ancien_troupe" name="ancien_troupe" required>
                        </div>
                        <span id="duree_ancien_scout"></span>
                    </div>
                    <!-- Section Chef -->
                    <div id="chef-section" style="display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="chef_scout_start_date">Date d'entrée au scoutisme: *</label>
                                    <input type="number" id="chef_scout_start_date" name="chef_scout_start_date" min="1950" max="2024" required>
                                    <span id="duree_scout_chef"></span>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="chef_start_date">Date de début en tant que chef: *</label>
                                    <input type="number" id="chef_start_date" name="chef_start_date" min="1950" max="2024" required>
                                    <span id="duree_chef"></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Formation BAFA:</label>
                            <div class="checkbox-group">
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_base" name="bafa[]" value="base">
                                    <label for="bafa_base">Formation générale (Base)</label>
                                </div>
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_pratique" name="bafa[]" value="pratique">
                                    <label for="bafa_pratique">Stage pratique</label>
                                </div>
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_appro" name="bafa[]" value="appro">
                                    <label for="bafa_appro">Approfondissement</label>
                                </div>
                                <div class="checkbox-container">
                                    <input type="checkbox" id="bafa_complet" name="bafa[]" value="complet">
                                    <label for="bafa_complet">BAFA Complet</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Rôle actuel: *</label>
                            <select id="chef_role" name="chef_role" required>
                                <option value="">-- Sélectionner --</option>
                                <option value="ct">Chef de Troupe</option>
                                <option value="acte">Assistant Chef de Troupe</option>
                                <option value="aumonier">Aumônier</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn-contact">Envoyer</button>
            </form>
            <div id="formStatus" class="form-status"></div>
        </div>
    </main>
    <footer>
        <p>&copy; Troupe Saint Elme</p>
    </footer>
    <script>
        // Fonction pour basculer l'affichage du menu mobile
        function toggleMobileMenu() {
            const mobileButton = document.querySelector('.mobile-menu-button');
            const mobileNav = document.querySelector('.mobile-nav');
            mobileButton.classList.toggle('active');
            mobileNav.classList.toggle('mobile-nav-active');
        }
        function updateProgression(level) {
            const progressionOrder = ['promesse', 'seconde', 'premiere', 'chevalier'];
            const levelIndex = progressionOrder.indexOf(level);
            const isChecked = document.getElementById(level).checked;
            if (isChecked) {
                // Cocher tous les niveaux inférieurs
                for (let i = 0; i <= levelIndex; i++) {
                    document.getElementById(progressionOrder[i]).checked = true;
                }
            } else {
                // Décocher tous les niveaux supérieurs
                for (let i = levelIndex; i < progressionOrder.length; i++) {
                    document.getElementById(progressionOrder[i]).checked = false;
                }
            }
        }
        function toggleAutrePatrouille() {
            const patrouilleSelect = document.getElementById('patrouille');
            const autrePatrouille = document.getElementById('autre_patrouille');
            if (patrouilleSelect.value === 'autre') {
                autrePatrouille.style.display = 'block';
                autrePatrouille.required = true;
            } else {
                autrePatrouille.style.display = 'none';
                autrePatrouille.required = false;
            }
        }
        function unsetRequiredInSection(section) {
            if (!section) return;
            section.querySelectorAll('[required]').forEach(el => {
                el.required = false;
                // Réinitialiser les valeurs des champs
                if (el.type === 'radio' || el.type === 'checkbox') {
                    el.checked = false;
                } else {
                    el.value = '';
                }
            });
        }
        function setRequired(ids) {
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.required = true;
                }
            });
        }
        function updateFormFields() {
            const scoutType = document.querySelector('input[name="profile_type"]:checked')?.value;
            const sections = {
                scout: document.getElementById('scout-section'),
                ancienScout: document.getElementById('ancien-scout-section'),
                chef: document.getElementById('chef-section')
            };

            // Masquer toutes les sections et retirer required
            Object.values(sections).forEach(section => {
                if (section) {
                    section.style.display = 'none';
                    unsetRequiredInSection(section);
                }
            });

            if (!scoutType || scoutType === 'visitor') return;

            // Afficher la section appropriée
            if (sections[scoutType]) {
                sections[scoutType].style.display = 'block';
            }

            if (scoutType === 'scout') {
                const isActiveScout = document.getElementById('is-active-scout')?.checked;
                const notActiveScout = document.getElementById('not-active-scout')?.checked;
                const saintElmeGroup = document.getElementById('saint-elme-appartenance-group');
                const autreTroupeGroup = document.getElementById('autre-troupe-group');
                const patrouilleRow = document.getElementById('patrouille-position-row');
                const notActiveDetails = document.getElementById('not-active-scout-details');

                // Toujours afficher le groupe d'appartenance à Saint Elme
                saintElmeGroup.style.display = 'block';
                document.getElementById('saint-elme-appartenance-label').textContent = 
                    isActiveScout ? "Appartiens-tu à la troupe Saint Elme ?" : 
                                  "Avez-vous appartenu à la troupe Saint Elme ?";

                if (isActiveScout) {
                    notActiveDetails.style.display = 'none';
                    autreTroupeGroup.style.display = 'block';
                    patrouilleRow.style.display = 'flex';
                } else if (notActiveScout) {
                    notActiveDetails.style.display = 'block';
                    autreTroupeGroup.style.display = 'none';
                    patrouilleRow.style.display = 'none';
                }

                // Gérer l'affichage du champ troupe uniquement si "Non" à Saint Elme
                document.querySelectorAll('input[name="saint_elme_appartenance"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        autreTroupeGroup.style.display = (this.value === 'non') ? 'block' : 'none';
                        const scoutTroupe = document.getElementById('scout_troupe');
                        if (this.value === 'non') {
                            scoutTroupe.required = true;
                            scoutTroupe.placeholder = isActiveScout ? 
                                "Nom de ta troupe actuelle" : 
                                "Nom de ton ancienne troupe";
                        } else {
                            scoutTroupe.required = false;
                            scoutTroupe.value = '';
                        }
                    });
                });

                // Cacher le champ troupe par défaut
                autreTroupeGroup.style.display = 'none';
            }
        }

        // Ajouter des écouteurs d'événements pour les changements de statut scout
        document.getElementById('is-active-scout')?.addEventListener('change', updateFormFields);
        document.getElementById('not-active-scout')?.addEventListener('change', updateFormFields);

        function resetAllFields() {
            const fieldsToReset = ['patrouille', 'position'];
            fieldsToReset.forEach(id => {
                const field = document.getElementById(id);
                if (field) {
                    field.value = '';
                    field.required = false;
                }
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        }
        // Calcul automatique de la durée
        function calculerDureeScout() {
            const dateDebut = document.getElementById('scout_start_date').value;
            const spanDuree = document.getElementById('duree_scout');
            if (!dateDebut) return;
            const anneeActuelle = new Date().getFullYear();
            const duree = anneeActuelle - dateDebut;
            spanDuree.textContent = ` (${duree} an${duree > 1 ? 's' : ''} de scoutisme)`;
        }
        function calculerDureeChef() {
            const dateDebutScout = document.getElementById('chef_scout_start_date').value;
            const dateDebutChef = document.getElementById('chef_start_date').value;
            const spanDureeScout = document.getElementById('duree_scout_chef');
            const spanDureeChef = document.getElementById('duree_chef');
            const anneeActuelle = new Date().getFullYear();
            if (dateDebutScout) {
                const dureeScout = anneeActuelle - dateDebutScout;
                spanDureeScout.textContent = ` (${dureeScout} an${dureeScout > 1 ? 's' : ''} de scoutisme)`;
            }
            if (dateDebutChef) {
                const dureeChef = anneeActuelle - dateDebutChef;
                spanDureeChef.textContent = ` (${dureeChef} an${dureeChef > 1 ? 's' : ''} en tant que chef)`;
            }
        }
        function calculerDureeAncienScout() {
            const dateDebut = document.getElementById('ancien_start_date').value;
            const dateFin = document.getElementById('ancien_end_date').value;
            const spanDuree = document.getElementById('duree_ancien_scout');
            if (!dateDebut || !dateFin) return;
            const duree = dateFin - dateDebut;
            spanDuree.textContent = ` (${duree} an${duree > 1 ? 's' : ''} de scoutisme)`;
        }
        document.getElementById('scout_start_date')?.addEventListener('input', calculerDureeScout);
        document.getElementById('chef_scout_start_date')?.addEventListener('input', calculerDureeChef);
        document.getElementById('chef_start_date')?.addEventListener('input', calculerDureeChef);
        document.getElementById('ancien_start_date')?.addEventListener('input', calculerDureeAncienScout);
        document.getElementById('ancien_end_date')?.addEventListener('input', calculerDureeAncienScout);
        // Écouteurs d'événements
        document.querySelectorAll('input[name="profile_type"]').forEach(radio => {
            radio.addEventListener('change', updateFormFields);
        });
        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            updateFormFields();
        });

        // Regrouper toutes les fonctions utilitaires
        const utils = {
            translateValue: function(name, value) {
                const translations = {
                    profile_type: {
                        scout: 'Scout',
                        chef: 'Chef',
                        visitor: 'Visiteur'
                    },
                    is_active_scout: {
                        yes: 'Oui',
                        no: 'Non'
                    },
                    saint_elme_appartenance: {
                        oui: 'Oui',
                        non: 'Non'
                    },
                    position: {
                        cp: 'Chef de Patrouille (CP)',
                        sp: 'Second de Patrouille'
                    },
                    chef_role: {
                        ct: 'Chef de Troupe',
                        acte: 'Assistant Chef de Troupe',
                        aumonier: 'Aumônier'
                    },
                    patrouille: {
                        cerf: 'Cerf',
                        loup: 'Loup',
                        isard: 'Isard',
                        lynx: 'Lynx',
                        levrier: 'Lévrier',
                        milan: 'Milan',
                        pygarge: 'Pygargue',
                        autre: 'Autre'
                    }
                };
                return translations[name]?.[value] || value;
            },
            
            getRadioValue: function(name, form) {
                const checked = form.querySelector(`input[name="${name}"]:checked`);
                return checked ? checked.value : '';
            },
            
            getCheckedValues: function(name, form) {
                return Array.from(form.querySelectorAll(`input[name="${name}[]"]:checked`))
                    .map(cb => cb.value)
                    .join(', ');
            },
            
            addIfFilled: function(label, value) {
                if (value && value.trim() !== '') {
                    return `<b>${label} :</b> ${value}<br>`;
                }
                return '';
            }
        };

        function buildEmailContent(form) {
            function addTableRow(question, value, defaultText = 'Non saisi') {
                const displayValue = value && value.trim() !== '' ? value : `<em style="color: #666;">${defaultText}</em>`;
                return `
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd;">${question}</td>
                        <td style="padding: 12px; border: 1px solid #ddd;">${displayValue}</td>
                    </tr>
                `;
            }

            let resume = `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db;">Informations de contact</h2>
                    <div style="margin-left: 20px;">
                        ${utils.addIfFilled('Nom', form.nom.value)}
                        ${utils.addIfFilled('Prénom', form.prenom.value)}
                        ${utils.addIfFilled('Email', form.email.value)}
                        ${utils.addIfFilled('Téléphone', form.telephone.value)}
                        ${utils.addIfFilled('Adresse', form.adresse.value)}
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db;">Message</h2>
                    <div style="margin-left: 20px; white-space: pre-wrap;">
                        ${form.message.value}
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db;">Récapitulatif détaillé</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <tr style="background-color: #f2f2f2;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Information</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Réponse</th>
                        </tr>
                        ${addTableRow('Nom', form.nom.value)}
                        ${addTableRow('Prénom', form.prenom.value)}
                        ${addTableRow('Email', form.email.value)}
                        ${addTableRow('Téléphone', form.telephone.value)}
                        ${addTableRow('Adresse', form.adresse.value)}
                        ${addTableRow('Profil', utils.translateValue('profile_type', utils.getRadioValue('profile_type', form)))}
            `;

            const profileType = utils.getRadioValue('profile_type', form);
            if (profileType === 'scout') {
                const isActiveScout = utils.getRadioValue('is_active_scout', form);
                resume += addTableRow('Scout actif', utils.translateValue('is_active_scout', isActiveScout));
                resume += addTableRow('Appartenance à Saint Elme', utils.translateValue('saint_elme_appartenance', utils.getRadioValue('saint_elme_appartenance', form)));
                resume += addTableRow("Date d'entrée au scoutisme", form.scout_start_date?.value);
                
                if (isActiveScout === 'yes') {
                    const patrouille = form.patrouille?.value;
                    if (patrouille) {
                        let patrouilleValue = utils.translateValue('patrouille', patrouille);
                        if (patrouille === 'autre') {
                            patrouilleValue += ` (${form.autre_patrouille?.value || 'non précisé'})`;
                        }
                        resume += addTableRow('Patrouille', patrouilleValue);
                    }
                    resume += addTableRow('Position dans la patrouille', utils.translateValue('position', form.position?.value));
                }

                if (isActiveScout === 'no') {
                    resume += addTableRow('Date de départ', form.scout_end_date?.value);
                }

                const progression = utils.getCheckedValues('progression', form);
                resume += addTableRow('Progression', progression);

                const badges = utils.getCheckedValues('badges', form);
                resume += addTableRow('Badges obtenus', badges);
            }

            if (profileType === 'chef') {
                resume += addTableRow("Date d'entrée au scoutisme", form.chef_scout_start_date?.value);
                resume += addTableRow('Date de début en tant que chef', form.chef_start_date?.value);
                resume += addTableRow('Formation BAFA', utils.getCheckedValues('bafa', form));
                resume += addTableRow('Rôle actuel', utils.translateValue('chef_role', form.chef_role?.value));
            }

            resume += `
                    </table>
                </div>
            `;
            
            return resume;
        }

        // Gestion de l'envoi du formulaire avec EmailJS
        document.getElementById('contactForm').addEventListener('submit', function(event) {
            event.preventDefault();

            document.getElementById('formStatus').textContent = 'Envoi en cours...';

            const form = this;
            const resume = buildEmailContent(form);

            const templateParams = {
                nom: form.nom.value,
                prenom: form.prenom.value,
                email: form.email.value,
                telephone: form.telephone.value,
                adresse: form.adresse.value,
                message: form.message.value,
                profile_type: utils.getRadioValue('profile_type', form),
                is_active_scout: utils.getRadioValue('is_active_scout', form),
                saint_elme_appartenance: utils.getRadioValue('saint_elme_appartenance', form),
                scout_troupe: form.scout_troupe ? form.scout_troupe.value : '',
                scout_start_date: form.scout_start_date ? form.scout_start_date.value : '',
                scout_end_date: form.scout_end_date ? form.scout_end_date.value : '',
                patrouille: form.patrouille ? form.patrouille.value : '',
                autre_patrouille: form.autre_patrouille ? form.autre_patrouille.value : '',
                position: form.position ? form.position.value : '',
                progression: utils.getCheckedValues('progression', form),
                badges: utils.getCheckedValues('badges', form),
                ancien_start_date: form.ancien_start_date ? form.ancien_start_date.value : '',
                ancien_end_date: form.ancien_end_date ? form.ancien_end_date.value : '',
                ancien_troupe: form.ancien_troupe ? form.ancien_troupe.value : '',
                chef_scout_start_date: form.chef_scout_start_date ? form.chef_scout_start_date.value : '',
                chef_start_date: form.chef_start_date ? form.chef_start_date.value : '',
                bafa: utils.getCheckedValues('bafa', form),
                chef_role: form.chef_role ? form.chef_role.value : '',
                html_message: resume // Pour affichage global dans le mail (compatible EmailJS)
            };

            emailjs.send('contact_troupe_st_elme', 'template_jbwjtge', templateParams)
                .then(function() {
                    document.getElementById('formStatus').textContent = 'Message envoyé avec succès!';
                    document.getElementById('contactForm').reset();
                }, function(error) {
                    document.getElementById('formStatus').textContent = 'Une erreur est survenue. Veuillez réessayer.';
                    console.error('Erreur:', error);
                });
        });
    </script>
</body>
</html>
